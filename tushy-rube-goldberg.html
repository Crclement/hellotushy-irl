<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>TUSHY Rube Goldberg Machine ‚Äî SoHo Loft Render v5</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { background: #fff; color: #111; font-family: 'Inter', sans-serif; }
  body { background: #fff; overflow-x: hidden; overflow-y: auto; }
  body.embed-mode { padding-top: 0; }

  /* Main presentation container */
  .presentation {
    max-width: 1200px;
    margin: 0 auto;
    padding: 48px 40px 60px;
  }
  @media (max-width: 768px) {
    .presentation { padding: 32px 20px 40px; }
  }

  /* Project header */
  .project-header {
    text-align: center;
    margin-bottom: 32px;
  }
  .project-header h1 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2.4rem;
    font-weight: 700;
    margin: 0 0 8px;
    color: #111;
  }
  .project-header .subtitle {
    font-size: 0.9rem;
    color: #999;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin: 0 0 24px;
  }
  .project-header .concept-brief {
    font-size: 1rem;
    line-height: 1.7;
    color: #444;
    max-width: 720px;
    margin: 0 auto;
  }
  @media (max-width: 768px) {
    .project-header h1 { font-size: 1.8rem; }
    .project-header .concept-brief { font-size: 0.9rem; }
  }

  /* Inline toolbar */
  .toolbar {
    display: flex;
    gap: 10px;
  }
  .toolbar button {
    padding: 10px 18px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 500;
    transition: all 0.2s;
  }
  .toolbar button:hover { border-color: #111; }
  .toolbar button:disabled { opacity: 0.4; cursor: default; }
  .toolbar button.primary {
    background: #111;
    color: #fff;
    border-color: #111;
  }
  .toolbar button.primary:hover { background: #333; }

  @media (max-width: 768px) {
    .toolbar { gap: 6px; }
    .toolbar button { padding: 8px 12px; font-size: 0.8rem; }
  }

  /* Map section - natural aspect ratio */
  .map-viewport {
    position: relative;
    width: 100%;
    background: #f8f8f8;
    border-radius: 12px;
    border: 1px solid #e0e0e0;
    overflow: hidden;
  }

  .map-viewport svg {
    display: block;
    width: 100%;
    height: auto;
    background: #fff;
  }

  /* Map editing/selecting state */
  .map-viewport.selecting-mode {
    background: #f0fdf4;
    border-color: #22c55e;
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2), inset 0 0 20px rgba(34, 197, 94, 0.05);
  }
  .map-viewport.selecting-mode svg {
    box-shadow: 0 0 0 2px #22c55e;
  }

  /* Hide non-embed elements in embed mode */
  .top-bar { display: none; }

  /* Top bar (for non-embed standalone view) */
  body:not(.embed-mode) .top-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 24px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid #e0e0e0;
  }
  body:not(.embed-mode) { padding-top: 56px; }

  .top-bar .back-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.85rem;
    font-weight: 500;
    color: #666;
    text-decoration: none;
    transition: color 0.2s;
  }
  .top-bar .back-link:hover { color: #111; }

  .top-bar .title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: #111;
  }

  .top-bar .actions {
    display: flex;
    gap: 12px;
  }

  .ideas-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: #111;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
  }
  .ideas-btn:hover { background: #333; }

  /* Station info popup on map click */
  .station-popup {
    position: fixed;
    z-index: 200;
    background: #fff;
    border: 2px solid #111;
    border-radius: 12px;
    padding: 20px;
    width: 320px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    display: none;
  }
  .station-popup.visible { display: block; }
  .station-popup-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
  }
  .station-popup-num {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.7rem;
    font-weight: 600;
    color: #999;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }
  .station-popup-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    color: #999;
    cursor: pointer;
    line-height: 1;
  }
  .station-popup-close:hover { color: #111; }
  .station-popup h3 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
  }
  .station-popup p {
    font-size: 0.82rem;
    line-height: 1.5;
    color: #555;
    margin-bottom: 16px;
  }
  .station-popup-actions {
    display: flex;
    gap: 10px;
  }
  .station-popup-btn {
    flex: 1;
    padding: 10px;
    border-radius: 6px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .station-popup-btn.secondary {
    background: #fff;
    border: 1px solid #ddd;
    color: #555;
  }
  .station-popup-btn.secondary:hover { border-color: #111; color: #111; }
  .station-popup-btn.primary {
    background: #111;
    border: 1px solid #111;
    color: #fff;
  }
  .station-popup-btn.primary:hover { background: #333; }

  /* Mobile: center popup */
  @media (max-width: 768px) {
    .station-popup {
      left: 50% !important;
      top: 50% !important;
      transform: translate(-50%, -50%);
      width: calc(100vw - 40px);
      max-width: 320px;
    }
  }

  /* Ideas panel (slide-in from right) */
  .ideas-panel {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 420px;
    max-width: 100vw;
    background: #fff;
    z-index: 300;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
    box-shadow: -10px 0 40px rgba(0,0,0,0.1);
  }
  .ideas-panel.open { transform: translateX(0); }

  /* Hide ideas panel when selecting station on map */
  body.selecting-station .ideas-panel { transform: translateX(100%); }

  @media (max-width: 768px) {
    .ideas-panel { width: 100vw; }
  }

  .ideas-panel-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
  }
  .ideas-panel-header h2 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.2rem;
    font-weight: 700;
  }
  .ideas-panel-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #999;
    cursor: pointer;
  }
  .ideas-panel-close:hover { color: #111; }

  .ideas-panel-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
  }

  .ideas-panel-footer {
    padding: 16px 20px;
    padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
    border-top: 1px solid #e0e0e0;
    flex-shrink: 0;
    background: #fff;
  }

  .ideas-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    z-index: 250;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .ideas-overlay.visible { opacity: 1; pointer-events: auto; }

  /* Idea cards in panel - click to expand */
  .idea-item {
    background: #fafafa;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px 14px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .idea-item:hover { border-color: #999; }
  .idea-item.expanded { border-color: #111; background: #fff; }
  .idea-item.selected { border-color: #111; border-width: 2px; background: #fff; }
  .idea-item-category {
    font-size: 0.65rem;
    font-weight: 600;
    color: #999;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 2px;
  }
  .idea-item h4 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.88rem;
    font-weight: 600;
    margin-bottom: 0;
  }
  .idea-item p {
    font-size: 0.76rem;
    line-height: 1.45;
    color: #666;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, margin 0.3s ease;
    margin: 0;
  }
  .idea-item.expanded p {
    max-height: 500px;
    margin-top: 6px;
  }
  .idea-item-author {
    font-size: 0.68rem;
    font-style: italic;
    color: #aaa;
    margin-top: 0;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: opacity 0.3s, max-height 0.3s, margin 0.3s;
  }
  .idea-item.expanded .idea-item-author {
    opacity: 1;
    max-height: 2em;
    margin-top: 4px;
  }
  .idea-item-actions {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: max-height 0.3s, opacity 0.3s;
  }
  .idea-item.expanded .idea-item-actions {
    max-height: 60px;
    opacity: 1;
  }

  /* SVG station styling */
  .station { cursor: pointer; }
  .station:hover rect,
  .station:hover path { stroke: #007AFF !important; stroke-width: 2.5 !important; }
  .station.has-idea rect { fill: #e8f5e9 !important; }
  .station .hidden-illustration { opacity: 0 !important; visibility: hidden !important; pointer-events: none !important; }
  .station .hidden-illustration.interactive-pulse { animation: none !important; opacity: 0 !important; }

  /* Mobile info icon on stations */
  @media (hover: none), (max-width: 768px) {
    .station .mobile-info-icon { display: block !important; }
  }
  .station .mobile-info-icon { display: none; }
  .station.selecting { cursor: pointer; }
  .station.selecting:hover { cursor: pointer; }
  .station.selecting:hover rect,
  .station.selecting:hover path { stroke: #22c55e !important; stroke-width: 3 !important; fill: #dcfce7 !important; }

  /* Hidden elements */
  .hidden { display: none !important; }

  /* Walkthrough content below map */
  .walkthrough-content { padding-bottom: 60px; }
  body.embed-mode .walkthrough-content { display: none; }
  .features { max-width: 1100px; margin: 0 auto; padding: 0 40px 40px; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 14px; }
  .feature-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 18px 22px; transition: border-color 0.3s; }
  .feature-card:hover { border-color: #999; }
  .feature-card .station-num { font-family: 'Space Grotesk', sans-serif; font-size: 0.68rem; font-weight: 600; color: #999; letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 5px; }
  .feature-card h3 { font-family: 'Space Grotesk', sans-serif; font-size: 1.05rem; font-weight: 600; margin-bottom: 8px; color: #000; }
  .feature-card p { font-size: 0.84rem; line-height: 1.6; color: #555; }
  .feature-card .products-used { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px; }
  .product-tag { font-size: 0.68rem; padding: 2px 9px; border-radius: 3px; background: #f5f5f5; color: #333; border: 1px solid #ddd; font-family: 'Inter', sans-serif; }
  .product-tag.interactive { font-weight: 600; border-style: dashed; }
  .product-tag.mechanic { font-style: italic; color: #888; border-color: #e0e0e0; }
  .section-label { max-width: 1100px; margin: 0 auto; padding: 40px 40px 16px; font-family: 'Space Grotesk', sans-serif; font-size: 0.85rem; font-weight: 600; letter-spacing: 0.15em; text-transform: uppercase; color: #111; border-bottom: 2px solid #111; margin-bottom: 20px; }
  .tooltip-overlay { position: fixed; pointer-events: none; background: #fff; border: 1px solid #ccc; border-radius: 6px; padding: 12px 16px; font-size: 0.78rem; color: #555; max-width: 280px; z-index: 100; opacity: 0; transition: opacity 0.2s; box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
  .tooltip-overlay.visible { opacity: 1; }
  .tooltip-overlay .tt-title { font-family: 'Space Grotesk', sans-serif; font-weight: 600; color: #000; margin-bottom: 4px; font-size: 0.85rem; }
  .dims-bar { text-align: center; padding: 0 0 6px; font-size: 0.72rem; color: #bbb; letter-spacing: 0.1em; }
  @keyframes dash { to { stroke-dashoffset: 0; } }
  .machine-path { stroke-dasharray: 3200; stroke-dashoffset: 3200; animation: dash 5s ease-in-out forwards; }
  @keyframes pulse { 0%, 100% { r: 6; opacity: 0.3; } 50% { r: 10; opacity: 0.7; } }
  .interactive-pulse { animation: pulse 2s ease-in-out infinite; }
  @keyframes waterFlow { 0% { stroke-dashoffset: 0; } 100% { stroke-dashoffset: -40; } }
  .water-flow { stroke-dasharray: 8, 12; animation: waterFlow 2s linear infinite; }
  /* Cost Estimate Section */
  .cost-section { max-width: 1100px; margin: 0 auto; padding: 0 40px 60px; }
  .cost-disclaimer { background: #fafafa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 14px 18px; margin-bottom: 20px; font-size: 0.82rem; line-height: 1.55; color: #666; }
  .cost-disclaimer strong { color: #000; }
  .cost-total { background: #fff; border: 2px solid #111; border-radius: 8px; padding: 20px 24px; margin-bottom: 20px; text-align: center; }
  .cost-total .amount { font-family: 'Space Grotesk', sans-serif; font-size: 2rem; font-weight: 700; color: #000; }
  .cost-total .label { font-size: 0.8rem; color: #999; letter-spacing: 0.1em; text-transform: uppercase; margin-top: 4px; }
  details.cost-category { background: #fff; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 8px; overflow: hidden; }
  details.cost-category:hover { border-color: #999; }
  details.cost-category[open] { border-color: #999; }
  details.cost-category summary { padding: 14px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-family: 'Space Grotesk', sans-serif; font-weight: 600; font-size: 0.92rem; color: #111; list-style: none; user-select: none; }
  details.cost-category summary::-webkit-details-marker { display: none; }
  details.cost-category summary::before { content: '\25B8'; margin-right: 10px; color: #bbb; transition: transform 0.2s; display: inline-block; }
  details.cost-category[open] summary::before { transform: rotate(90deg); }
  .cost-subtotal { font-family: 'Space Grotesk', sans-serif; font-weight: 600; color: #000; font-size: 0.9rem; }
  .cost-items { padding: 0 20px 16px; }
  .cost-item { display: flex; justify-content: space-between; align-items: center; padding: 7px 0; border-bottom: 1px solid #f0f0f0; font-size: 0.82rem; gap: 8px; }
  .cost-item:last-child { border-bottom: none; }
  .cost-item-name { color: #555; flex: 1; }
  .cost-item-name a { color: #111; text-decoration: underline; text-decoration-color: #ccc; text-underline-offset: 2px; }
  .cost-item-name a:hover { text-decoration-color: #111; }
  .cost-item-qty { color: #999; font-size: 0.75rem; min-width: 50px; text-align: center; }
  .cost-item-price { font-family: 'Space Grotesk', sans-serif; font-weight: 500; color: #000; min-width: 70px; text-align: right; }
  /* Idea cards */
  .idea-card { position: relative; transition: border-color 0.2s, box-shadow 0.2s; }
  .idea-card:hover { border-color: #111; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
  .idea-card.assigned { border-color: #111; background: linear-gradient(135deg, #f9f9f9 0%, #fff 100%); }
  .idea-card.assigned .assigned-badge { display: flex; }

  /* Station picker inline */
  .station-picker {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #eee;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .station-picker-label {
    font-size: 0.72rem;
    color: #999;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .station-picker-btns {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  .station-pick-btn {
    width: 32px;
    height: 32px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #fff;
    color: #666;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
  }
  .station-pick-btn:hover { border-color: #111; color: #111; background: #f5f5f5; }
  .station-pick-btn.active { background: #111; color: #fff; border-color: #111; }

  /* Assigned badge */
  .assigned-badge {
    display: none;
    position: absolute;
    top: 10px;
    right: 14px;
    align-items: center;
    gap: 6px;
    font-size: 0.7rem;
    font-weight: 600;
    color: #fff;
    background: #111;
    padding: 4px 10px;
    border-radius: 4px;
    font-family: 'Space Grotesk', sans-serif;
  }
  .assigned-badge .clear-assign {
    background: none;
    border: none;
    color: rgba(255,255,255,0.6);
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0;
    margin-left: 4px;
    line-height: 1;
  }
  .assigned-badge .clear-assign:hover { color: #fff; }
  /* Add Idea card - same size as idea cards */
  .add-idea-card {
    background: #fafafa;
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 18px 22px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    min-height: 180px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .add-idea-card:hover { border-color: #111; background: #fff; }
  .add-idea-card .plus-icon {
    width: 48px;
    height: 48px;
    border: 2px solid #ddd;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: #bbb;
    margin-bottom: 12px;
    transition: all 0.2s;
  }
  .add-idea-card:hover .plus-icon { border-color: #111; color: #111; }
  .add-idea-card h3 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: #666;
    margin-bottom: 4px;
  }
  .add-idea-card:hover h3 { color: #111; }
  .add-idea-card p {
    font-size: 0.8rem;
    color: #999;
  }

  /* Idea card actions */
  .idea-actions {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 6px;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .feature-card:hover .idea-actions { opacity: 1; }
  .idea-action-btn {
    width: 26px;
    height: 26px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: #fff;
    color: #999;
    font-size: 0.75rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }
  .idea-action-btn:hover { border-color: #111; color: #111; }
  .idea-action-btn.delete:hover { border-color: #e53935; color: #e53935; }
  .idea-action-btn.core { color: #999; }
  .idea-action-btn.core.is-core { color: #f59e0b; border-color: #f59e0b; }
  .feature-card.user-idea { position: relative; }
  .idea-author { font-style: italic; color: #bbb; margin-left: 8px; }

  /* Add Idea Modal */
  .idea-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 400;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .idea-modal-overlay.visible { display: flex; }
  .idea-modal {
    background: #fff;
    border-radius: 12px;
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }
  .idea-modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .idea-modal-header h3 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
  }
  .idea-modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #999;
    cursor: pointer;
    line-height: 1;
  }
  .idea-modal-close:hover { color: #111; }
  .idea-modal-body { padding: 24px; }
  .idea-form-group { margin-bottom: 18px; }
  .idea-form-group label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: #555;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .idea-form-group input,
  .idea-form-group textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-family: inherit;
    font-size: 0.95rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .idea-form-group input:focus,
  .idea-form-group textarea:focus { border-color: #111; }
  .idea-form-group textarea { min-height: 100px; resize: vertical; }
  .idea-form-row { display: flex; gap: 16px; margin-bottom: 18px; }
  .idea-form-row .idea-form-group { margin-bottom: 0; flex: 1; }
  .idea-form-row .idea-form-group.emoji-group { flex: 0 0 100px; }
  /* Category Select */
  .category-select { position: relative; }
  .category-selected { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; background: #fff; transition: border-color 0.2s; }
  .category-selected:hover { border-color: #999; }
  .category-selected .cat-icon { font-size: 1.1rem; }
  .category-selected .cat-label { flex: 1; font-size: 0.95rem; }
  .category-selected svg { color: #999; }
  .category-options { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ddd; border-radius: 6px; margin-top: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none; z-index: 10; overflow: hidden; }
  .category-options.open { display: block; }
  .category-option { display: flex; align-items: center; gap: 10px; padding: 10px 14px; cursor: pointer; transition: background 0.15s; }
  .category-option:hover { background: #f5f5f5; }
  .category-option .cat-icon { font-size: 1.1rem; }
  /* Emoji Picker */
  .emoji-picker { position: relative; }
  .emoji-selected { width: 100%; height: 44px; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; background: #fff; transition: border-color 0.2s; }
  .emoji-selected:hover { border-color: #999; }
  .emoji-grid { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: #fff; border: 1px solid #ddd; border-radius: 8px; margin-top: 4px; box-shadow: 0 4px 16px rgba(0,0,0,0.12); display: none; z-index: 10; padding: 8px; width: 200px; }
  .emoji-grid.open { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
  .emoji-grid span { font-size: 1.4rem; padding: 8px; text-align: center; cursor: pointer; border-radius: 6px; transition: background 0.15s; }
  .emoji-grid span:hover { background: #f0f0f0; }
  .idea-modal-footer {
    padding: 16px 24px;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }
  .idea-modal-btn {
    padding: 10px 20px;
    border-radius: 6px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .idea-modal-btn.secondary {
    background: #fff;
    border: 1px solid #ddd;
    color: #555;
  }
  .idea-modal-btn.secondary:hover { border-color: #111; color: #111; }
  .idea-modal-btn.primary {
    background: #111;
    border: 1px solid #111;
    color: #fff;
  }
  .idea-modal-btn.primary:hover { background: #333; }

  .swap-flash { animation: flashGreen 0.6s ease-out; }
  @keyframes flashGreen { 0% { background: #e8f5e9; } 100% { background: #fff; } }
</style>
</head>
<body>

<!-- Top Bar (standalone view only) -->
<div class="top-bar">
  <a href="index.html" class="back-link" id="backLink">‚Üê Projects</a>
  <span class="title">TUSHY √ó Rube Goldberg</span>
  <div class="actions"></div>
</div>

<!-- Presentation Container -->
<div class="presentation">

<!-- Project Header -->
<div class="project-header">
  <h1>TUSHY √ó Rube Goldberg Machine</h1>
  <p class="subtitle">SoHo Loft Activation</p>
  <p class="concept-brief">A 10-station chain-reaction machine winding through a 30√ó60 ft SoHo loft, showcasing the full TUSHY product line. A continuous water channel runs along the perimeter, feeding real bidets throughout the installation. Everything recirculates ‚Äî water, balls, energy. A jumbo üí© ball rolls the course, triggering bidets, unfurling TP, lighting candles, and releasing smaller üí© balls along the way. Interactive stations let visitors help keep it moving.</p>
</div>

<hr style="border:none;border-top:1px solid #ddd;margin:48px 0 32px;width:100vw;position:relative;left:50%;transform:translateX(-50%);">

<!-- Map Section Header -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px;">
  <h2 style="font-family:'Space Grotesk',sans-serif;font-size:1.1rem;font-weight:600;color:#111;letter-spacing:0.12em;text-transform:uppercase;margin:0;">Installation Layout</h2>
  <div class="toolbar" style="margin:0;">
    <button id="undoBtn" disabled title="Undo (Cmd+Z)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>Undo</button>
    <button id="redoBtn" disabled title="Redo (Cmd+Shift+Z)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/></svg>Redo</button>
    <button id="openIdeasBtn" class="primary">Ideas</button>
  </div>
</div>
<div class="map-viewport">
<svg class="loft-render" viewBox="0 0 1060 600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="ss"><feDropShadow dx="0" dy="1" stdDeviation="1.5" flood-color="rgba(0,0,0,0.06)"/></filter>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M20 0L0 0 0 20" fill="none" stroke="rgba(0,0,0,0.04)" stroke-width="0.5"/>
    </pattern>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0L8,3L0,6" fill="none" stroke="#333" stroke-width="1"/>
    </marker>
    <marker id="arr-w" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0L8,3L0,6" fill="none" stroke="#0277BD" stroke-width="1"/>
    </marker>
  </defs>

  <!-- LOFT FLOOR -->
  <rect x="50" y="40" width="960" height="520" rx="4" fill="#fff" stroke="#222" stroke-width="2"/>
  <rect x="50" y="40" width="960" height="520" rx="4" fill="url(#grid)"/>

  <!-- WINDOWS (top wall) -->
  <g opacity="0.35">
    <rect x="220" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="285" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="350" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="415" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="480" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="545" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="610" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="675" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="740" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="805" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="870" y="38" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="935" y="38" width="50" height="5" rx="2" fill="#bbb"/>
  </g>
  <!-- WINDOWS (bottom wall) -->
  <g opacity="0.35">
    <rect x="220" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="285" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="350" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="415" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="480" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="545" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="610" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="675" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="740" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="805" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="870" y="557" width="50" height="5" rx="2" fill="#bbb"/>
    <rect x="935" y="557" width="50" height="5" rx="2" fill="#bbb"/>
  </g>

  <!-- ENTRANCE (top of left wall) -->
  <rect x="47" y="55" width="7" height="55" rx="2" fill="#111"/>
  <text x="28" y="82" fill="#111" font-size="7" text-anchor="middle" transform="rotate(-90,28,82)" font-family="Space Grotesk, sans-serif" letter-spacing="0.12em" font-weight="700">ENTER</text>

  <!-- EXIT (below entrance) -->
  <rect x="47" y="115" width="7" height="45" rx="2" fill="none" stroke="#111" stroke-width="1.5" stroke-dasharray="3,2"/>
  <text x="28" y="138" fill="#666" font-size="7" text-anchor="middle" transform="rotate(-90,28,138)" font-family="Space Grotesk, sans-serif" letter-spacing="0.12em" font-weight="600">EXIT</text>

  <!-- DIMENSIONS -->
  <line x1="50" y1="24" x2="1010" y2="24" stroke="#ddd" stroke-width="0.5" stroke-dasharray="2,4"/>
  <text x="530" y="19" fill="#bbb" font-size="7.5" text-anchor="middle" font-family="Inter, sans-serif">60 FT</text>
  <line x1="1028" y1="40" x2="1028" y2="560" stroke="#ddd" stroke-width="0.5" stroke-dasharray="2,4"/>
  <text x="1043" y="303" fill="#bbb" font-size="7.5" text-anchor="middle" font-family="Inter, sans-serif" transform="rotate(90,1043,303)">30 FT</text>

  <!-- DIVIDER -->
  <line x1="210" y1="130" x2="210" y2="440" stroke="#ccc" stroke-width="1" stroke-dasharray="6,4"/>
  <text x="216" y="84" fill="#999" font-size="4.5" font-family="Inter, sans-serif">&rarr; IN</text>
  <text x="195" y="460" fill="#999" font-size="4.5" font-family="Inter, sans-serif" text-anchor="end">BA &larr;</text>

  <!-- OPEN CENTER -->
  <text x="610" y="292" fill="#ddd" font-size="9" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="300" letter-spacing="0.25em">OPEN VIEWING AREA</text>
  <text x="610" y="308" fill="#e0e0e0" font-size="6" text-anchor="middle" font-family="Inter, sans-serif">spectators watch from center</text>

  <!-- ========== MACHINE PATH ========== -->
  <path class="machine-path" d="
    M 260,100
    L 950,100
    C 970,100 980,115 980,130
    L 980,470
    C 980,490 965,500 950,500
    L 260,500
  " fill="none" stroke="#222" stroke-width="2.5" stroke-linecap="round" opacity="0.2"/>

  <!-- Direction arrows -->
  <path d="M400,100 L425,100" fill="none" stroke="#333" stroke-width="1.5" marker-end="url(#arr)" opacity="0.35"/>
  <path d="M650,100 L675,100" fill="none" stroke="#333" stroke-width="1.5" marker-end="url(#arr)" opacity="0.35"/>
  <path d="M980,280 L980,305" fill="none" stroke="#333" stroke-width="1.5" marker-end="url(#arr)" opacity="0.35"/>
  <path d="M800,500 L775,500" fill="none" stroke="#333" stroke-width="1.5" marker-end="url(#arr)" opacity="0.35"/>
  <path d="M500,500 L475,500" fill="none" stroke="#333" stroke-width="1.5" marker-end="url(#arr)" opacity="0.35"/>

  <!-- Jumbo ball at start -->
  <text x="245" y="96" font-size="13" text-anchor="middle">&#x1F4A9;</text>
  <text x="245" y="114" fill="#999" font-size="4.5" text-anchor="middle" font-family="Inter, sans-serif">jumbo ball</text>

  <!-- ========== BRAND ACTIVATION (left zone) ========== -->
  <g class="station" data-station="ba" data-name="Brand Activation Zone" data-desc="After completing the machine, visitors enter the BA zone. Walking upward: Accessories Wall, Scent Bar, Retail + Merch, Bidet Demos, Golden Throne photo op. Then exit.">
    <rect x="58" y="50" width="144" height="440" rx="4" fill="#fafafa" stroke="#ccc" stroke-width="1"/>

    <!-- GREETER (same height as station boxes) -->
    <rect x="68" y="58" width="55" height="80" rx="3" fill="#fff" stroke="#999" stroke-width="0.8"/>
    <text x="95" y="85" fill="#000" font-size="5.5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">GREETER</text>
    <text x="95" y="98" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">welcome desk</text>
    <text x="95" y="111" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">door person</text>
    <text x="95" y="124" fill="#bbb" font-size="3.5" text-anchor="middle" font-family="Inter, sans-serif" font-weight="600" letter-spacing="0.08em">FIRST STOP</text>

    <!-- GOLDEN THRONE -->
    <rect x="68" y="150" width="124" height="80" rx="4" fill="#fff" stroke="#999" stroke-width="1"/>
    <text x="130" y="175" fill="#000" font-size="12" text-anchor="middle">&#x1F451;</text>
    <text x="130" y="195" fill="#000" font-size="5.5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">GOLDEN THRONE</text>
    <text x="130" y="207" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">photo op &middot; ring light</text>
    <text x="130" y="218" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">branded backdrop</text>
    <text x="130" y="228" fill="#bbb" font-size="3.2" text-anchor="middle" font-family="Inter, sans-serif" font-weight="600" letter-spacing="0.08em">LAST STOP</text>

    <!-- BIDET DEMOS -->
    <rect x="68" y="240" width="124" height="42" rx="3" fill="#fff" stroke="#bbb" stroke-width="0.8"/>
    <text x="130" y="258" fill="#000" font-size="5.5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="600">BIDET DEMOS</text>
    <text x="130" y="270" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">all models &middot; try before buy</text>

    <!-- RETAIL + MERCH -->
    <rect x="68" y="292" width="124" height="40" rx="3" fill="#fff" stroke="#bbb" stroke-width="0.8"/>
    <text x="130" y="310" fill="#000" font-size="5.5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="600">RETAIL + MERCH</text>
    <text x="130" y="322" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">full product lineup</text>

    <!-- SCENT BAR -->
    <rect x="68" y="342" width="124" height="40" rx="3" fill="#fff" stroke="#bbb" stroke-width="0.8"/>
    <text x="130" y="360" fill="#000" font-size="5.5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="600">SCENT BAR</text>
    <text x="130" y="372" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">candles &middot; sprays &middot; sampling</text>

    <!-- ACCESSORIES -->
    <rect x="68" y="392" width="124" height="45" rx="3" fill="#fff" stroke="#bbb" stroke-width="0.8"/>
    <text x="130" y="411" fill="#000" font-size="5.5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="600">ACCESSORIES</text>
    <text x="130" y="423" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">TP &middot; towels &middot; brushes</text>
    <text x="130" y="433" fill="#999" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif">ottomans &middot; stands</text>

    <!-- BA flow arrow -->
    <line x1="185" y1="435" x2="185" y2="155" stroke="#999" stroke-width="0.8" stroke-dasharray="4,3" opacity="0.4" marker-end="url(#arr)"/>
    <text x="196" y="295" fill="#bbb" font-size="3.8" font-family="Inter, sans-serif" transform="rotate(-90,196,295)">VISITOR FLOW &uarr;</text>

    <!-- Label -->
    <text x="130" y="462" fill="#000" font-size="5" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700" letter-spacing="0.06em">BRAND ACTIVATION</text>
    <text x="130" y="474" fill="#999" font-size="4" text-anchor="middle" font-family="Inter, sans-serif">enter from Stn &#9321; &middot; exit top</text>
  </g>

  <!-- Guest flow annotation -->
  <text x="130" y="540" fill="#bbb" font-size="4.2" text-anchor="middle" font-family="Inter, sans-serif" letter-spacing="0.05em">IN &rarr; GREETER &rarr; MACHINE &rarr; BA &rarr; OUT</text>

  <!-- ========== TOP WALL STATIONS ========== -->

  <!-- STATION 1: GREAT CASCADE -->
  <g class="station" data-station="1" data-name="&#9312; The Great Cascade" data-desc="A TUSHY Classic 3.0 mounted on a real toilet fires a jet of water that launches the üí© jumbo ball down the first ramp. Water feeds into the recirculating channel. AUTO-RESET: Return track from Finale drops ball into starting position.">
    <rect x="225" y="55" width="130" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" filter="url(#ss)"/>
    <!-- Bidet/water icon -->
    <circle cx="290" cy="85" r="16" fill="none" stroke="#555" stroke-width="1.2"/>
    <path d="M284,79 L290,92 L296,79" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round"/>
    <circle cx="290" cy="100" r="1.5" fill="#999"/>
    <circle cx="286" cy="104" r="1" fill="#bbb"/>
    <circle cx="294" cy="103" r="1" fill="#bbb"/>
    <text x="290" y="124" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">THE GREAT CASCADE</text>
    <text x="290" y="50" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9312; START</text>
  </g>

  <!-- STATION 2: BAMBOO GROVE -->
  <g class="station" data-station="2" data-name="&#9313; The Bamboo Grove" data-desc="Dense grove of real bamboo poles with TUSHY Bamboo TP rolls and fabric. Jumbo ball weaves through, triggering TP to unroll like scrolls ‚Äî counterweights that lower bridges and release gates. AUTO-RESET: Motorized rewind spools.">
    <rect x="375" y="55" width="150" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" filter="url(#ss)"/>
    <!-- Bamboo poles (black vertical lines) -->
    <line x1="400" y1="62" x2="400" y2="128" stroke="#555" stroke-width="2.5" stroke-linecap="round" opacity="0.4"/>
    <line x1="418" y1="62" x2="418" y2="128" stroke="#444" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
    <line x1="436" y1="62" x2="436" y2="128" stroke="#666" stroke-width="2" stroke-linecap="round" opacity="0.35"/>
    <line x1="454" y1="62" x2="454" y2="128" stroke="#555" stroke-width="2.5" stroke-linecap="round" opacity="0.45"/>
    <line x1="472" y1="62" x2="472" y2="128" stroke="#444" stroke-width="3" stroke-linecap="round" opacity="0.4"/>
    <line x1="490" y1="62" x2="490" y2="128" stroke="#666" stroke-width="2" stroke-linecap="round" opacity="0.3"/>
    <line x1="505" y1="62" x2="505" y2="128" stroke="#555" stroke-width="2.5" stroke-linecap="round" opacity="0.45"/>
    <!-- TP rolls on poles -->
    <circle cx="418" cy="82" r="6" fill="none" stroke="#999" stroke-width="1.2"/>
    <circle cx="454" cy="90" r="5" fill="none" stroke="#999" stroke-width="1"/>
    <circle cx="490" cy="78" r="6" fill="none" stroke="#999" stroke-width="1.2"/>
    <text x="450" y="124" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">THE BAMBOO GROVE</text>
    <text x="450" y="50" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9313;</text>
  </g>

  <!-- STATION 3: SPRAY GATE -->
  <g class="station interactive" data-station="3" data-name="&#9314; The Spray Gate &#x270B;" data-desc="INTERACTIVE: Jumbo ball jams behind a translucent gate. Visitors press a lit arcade button that triggers real wall-mounted bidets to spray the gate clean. Counterweighted gate swings open. AUTO-RESET: Gate springs back.">
    <rect x="545" y="55" width="130" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" filter="url(#ss)"/>
    <circle class="interactive-pulse" cx="610" cy="85" r="6" fill="rgba(0,0,0,0.1)"/>
    <circle cx="610" cy="85" r="14" fill="none" stroke="#444" stroke-width="1.2"/>
    <circle cx="610" cy="85" r="7" fill="none" stroke="#333" stroke-width="1"/>
    <text x="610" y="89" fill="#111" font-size="7" text-anchor="middle" font-weight="700">&#x23FA;</text>
    <line x1="595" y1="104" x2="590" y2="114" stroke="#999" stroke-width="0.8" opacity="0.4"/>
    <line x1="610" y1="106" x2="610" y2="116" stroke="#999" stroke-width="0.8" opacity="0.4"/>
    <line x1="625" y1="104" x2="630" y2="114" stroke="#999" stroke-width="0.8" opacity="0.4"/>
    <text x="610" y="124" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">SPRAY GATE</text>
    <text x="610" y="50" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9314; &#x270B; INTERACTIVE</text>
  </g>

  <!-- STATION 4: OTTOMAN STAIRCASE -->
  <g class="station" data-station="4" data-name="&#9315; The Ottoman Staircase" data-desc="Descending staircase of TUSHY Ottoman Original (9&quot;) stools. Jumbo ball bounces down each padded step. Final Ottoman triggers a seesaw lever. AUTO-RESET: Spring-loaded surfaces pop back.">
    <rect x="695" y="55" width="140" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" filter="url(#ss)"/>
    <rect x="715" y="75" width="24" height="11" rx="4" fill="none" stroke="#555" stroke-width="1.2"/>
    <rect x="745" y="82" width="24" height="11" rx="4" fill="none" stroke="#555" stroke-width="1.2"/>
    <rect x="775" y="89" width="24" height="11" rx="4" fill="none" stroke="#555" stroke-width="1.2"/>
    <rect x="805" y="96" width="24" height="11" rx="4" fill="none" stroke="#555" stroke-width="1.2"/>
    <path d="M727,73 Q736,63 746,80" fill="none" stroke="#999" stroke-width="0.7" stroke-dasharray="2,2"/>
    <path d="M757,80 Q766,70 776,87" fill="none" stroke="#999" stroke-width="0.7" stroke-dasharray="2,2"/>
    <path d="M787,87 Q796,77 806,94" fill="none" stroke="#999" stroke-width="0.7" stroke-dasharray="2,2"/>
    <text x="765" y="124" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">OTTOMAN STAIRCASE</text>
    <text x="765" y="50" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9315;</text>
  </g>

  <!-- STATION 5: CANDLE LANE -->
  <g class="station" data-station="5" data-name="&#9316; Candle Lane" data-desc="Corridor of TUSHY candles with LED flickering flames. Pressure plates trigger LEDs in sequence. Room Spray misters release scent. OPTION: Real flames with torch igniters ‚Äî mini balls trigger vacuum tubes to extinguish and pull smoke. AUTO-RESET: 30s timer.">
    <rect x="855" y="55" width="130" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" filter="url(#ss)"/>
    <!-- Candle shapes (monochrome) -->
    <rect x="878" y="72" width="8" height="18" rx="2" fill="none" stroke="#777" stroke-width="0.8"/>
    <text x="882" y="69" fill="#333" font-size="5" text-anchor="middle">&#x2727;</text>
    <rect x="898" y="78" width="8" height="18" rx="2" fill="none" stroke="#777" stroke-width="0.8"/>
    <text x="902" y="75" fill="#333" font-size="5" text-anchor="middle">&#x2727;</text>
    <rect x="918" y="70" width="8" height="18" rx="2" fill="none" stroke="#777" stroke-width="0.8"/>
    <text x="922" y="67" fill="#333" font-size="5" text-anchor="middle">&#x2727;</text>
    <rect x="938" y="76" width="8" height="18" rx="2" fill="none" stroke="#777" stroke-width="0.8"/>
    <text x="942" y="73" fill="#333" font-size="5" text-anchor="middle">&#x2727;</text>
    <text x="920" y="124" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">CANDLE LANE</text>
    <text x="920" y="50" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9316;</text>
  </g>

  <!-- ========== RIGHT WALL STATIONS ========== -->

  <!-- STATION 6: GREAT UNROLL -->
  <g class="station interactive" data-station="6" data-name="&#9317; The Great Unroll &#x270B;" data-desc="INTERACTIVE: Giant spool of fabric (cut to look like a giant TP roll) mounted on the wall. Visitors physically pull it ‚Äî acts as a pulley rope lifting a gate and releasing the jumbo ball. AUTO-RESET: Motorized spool rewinds (~90s).">
    <rect x="920" y="155" width="65" height="120" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" filter="url(#ss)"/>
    <circle class="interactive-pulse" cx="952" cy="205" r="6" fill="rgba(0,0,0,0.08)"/>
    <circle cx="952" cy="205" r="20" fill="none" stroke="#555" stroke-width="1"/>
    <circle cx="952" cy="205" r="9" fill="none" stroke="#333" stroke-width="0.8"/>
    <path d="M972,205 Q988,195 992,210" fill="none" stroke="#999" stroke-width="1" stroke-dasharray="3,2"/>
    <text x="952" y="250" fill="#000" font-size="6" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">GREAT</text>
    <text x="952" y="260" fill="#000" font-size="6" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">UNROLL</text>
    <text x="952" y="150" fill="#999" font-size="5" text-anchor="middle" font-family="Inter, sans-serif">&#9317; &#x270B;</text>
  </g>

  <!-- STATION 7: SCRUB ZONE -->
  <g class="station" data-station="7" data-name="&#9318; The Ball Wash" data-desc="TUSHY Toilet Brushes with scrubbing pads as spinning paddle wheels. Jumbo ball enters a cleaning gauntlet lined with Bum Towels that dry it off. Lemon + tea tree scent. AUTO-RESET: Always running.">
    <rect x="920" y="295" width="65" height="120" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" filter="url(#ss)"/>
    <g transform="translate(948,330)">
      <circle r="12" fill="none" stroke="#555" stroke-width="1"/>
      <line x1="-8" y1="0" x2="8" y2="0" stroke="#555" stroke-width="1.2"/>
      <line x1="0" y1="-8" x2="0" y2="8" stroke="#555" stroke-width="1.2"/>
      <line x1="-6" y1="-6" x2="6" y2="6" stroke="#777" stroke-width="0.8"/>
      <line x1="6" y1="-6" x2="-6" y2="6" stroke="#777" stroke-width="0.8"/>
    </g>
    <g transform="translate(958,365)">
      <circle r="9" fill="none" stroke="#555" stroke-width="0.8"/>
      <line x1="-6" y1="0" x2="6" y2="0" stroke="#555" stroke-width="1"/>
      <line x1="0" y1="-6" x2="0" y2="6" stroke="#555" stroke-width="1"/>
    </g>
    <text x="952" y="395" fill="#000" font-size="6" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">SCRUB</text>
    <text x="952" y="405" fill="#000" font-size="6" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">ZONE</text>
    <text x="952" y="290" fill="#999" font-size="5" text-anchor="middle" font-family="Inter, sans-serif">&#9318;</text>
  </g>

  <!-- ========== BOTTOM WALL STATIONS ========== -->

  <!-- STATION 8: THRONE STOMP -->
  <g class="station interactive" data-station="8" data-name="&#9319; The Throne Stomp &#x270B;" data-desc="INTERACTIVE: TUSHY Ottoman with pressure plate. Visitor steps on it to release the jumbo ball. TUSHY Ace / Aura displayed as the Royal Throne. AUTO-RESET: Pressure plate springs back.">
    <rect x="765" y="460" width="140" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" filter="url(#ss)"/>
    <circle class="interactive-pulse" cx="835" cy="490" r="6" fill="rgba(0,0,0,0.08)"/>
    <rect x="812" y="480" width="46" height="20" rx="7" fill="none" stroke="#555" stroke-width="1.2"/>
    <text x="835" y="495" fill="#333" font-size="10" text-anchor="middle">&#x1F463;</text>
    <text x="835" y="527" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">THRONE STOMP</text>
    <text x="835" y="455" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9319; &#x270B;</text>
  </g>

  <!-- STATION 9: BIDET SYMPHONY -->
  <g class="station" data-station="9" data-name="&#9320; The Bidet Symphony &#x1F3B5;" data-desc="10 real bidets with Arduino-controlled solenoids play water choreography to classical music. Jumbo ball triggers each bidet in sequence. Visitors freestyle with arcade buttons between runs. Screen plays original TUSHY commercial. AUTO-RESET: Solenoids auto-off.">
    <rect x="530" y="460" width="215" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="1.5" filter="url(#ss)"/>
    <!-- Music notes (monochrome) -->
    <text x="565" y="487" fill="#555" font-size="9" text-anchor="middle">&#9833;</text>
    <text x="585" y="482" fill="#777" font-size="7" text-anchor="middle">&#9834;</text>
    <text x="605" y="490" fill="#444" font-size="10" text-anchor="middle">&#9835;</text>
    <text x="625" y="484" fill="#777" font-size="7" text-anchor="middle">&#9833;</text>
    <text x="645" y="488" fill="#555" font-size="9" text-anchor="middle">&#9834;</text>
    <text x="665" y="482" fill="#666" font-size="8" text-anchor="middle">&#9835;</text>
    <text x="685" y="487" fill="#555" font-size="9" text-anchor="middle">&#9833;</text>
    <text x="705" y="484" fill="#777" font-size="7" text-anchor="middle">&#9834;</text>
    <text x="725" y="490" fill="#666" font-size="8" text-anchor="middle">&#9835;</text>
    <!-- Bidet row -->
    <g opacity="0.5">
      <rect x="555" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="570" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="585" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="600" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="615" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="630" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="645" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="660" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="675" y="496" width="7" height="4" rx="1" fill="#555"/>
      <rect x="690" y="496" width="7" height="4" rx="1" fill="#555"/>
    </g>
    <!-- Arcade console -->
    <rect x="700" y="506" width="35" height="14" rx="3" fill="none" stroke="#555" stroke-width="0.8" stroke-dasharray="2,2"/>
    <circle cx="710" cy="513" r="2.5" fill="none" stroke="#555" stroke-width="0.6"/>
    <circle cx="720" cy="513" r="2.5" fill="none" stroke="#555" stroke-width="0.6"/>
    <circle cx="730" cy="513" r="2.5" fill="none" stroke="#555" stroke-width="0.6"/>
    <!-- Video screen -->
    <rect x="555" y="508" width="30" height="15" rx="2" fill="#f5f5f5" stroke="#bbb" stroke-width="0.6"/>
    <text x="570" y="517" fill="#999" font-size="3.5" text-anchor="middle" font-family="Inter, sans-serif">VIDEO</text>
    <text x="637" y="527" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">BIDET SYMPHONY</text>
    <text x="637" y="455" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9320; &#x270B; + MACHINE</text>
  </g>

  <!-- STATION 10: GRAND FLUSH FINALE -->
  <g class="station" data-station="10" data-name="&#9321; The Grand Flush Finale" data-desc="Jumbo ball drops into giant illuminated toilet bowl. Flush triggers LED light show. Bowl fills with mini üí© balls that swirl and drain. TUSHY logo blazes. AUTO-RESET: Gravity track returns jumbo ball to Station 1.">
    <rect x="225" y="460" width="285" height="80" rx="5" fill="#fff" stroke="#333" stroke-width="2" filter="url(#ss)"/>
    <circle cx="368" cy="492" r="20" fill="none" stroke="#ccc" stroke-width="0.8"/>
    <circle cx="368" cy="492" r="12" fill="none" stroke="#555" stroke-width="1"/>
    <!-- Burst lines -->
    <line x1="368" y1="470" x2="368" y2="463" stroke="#555" stroke-width="1"/>
    <line x1="386" y1="476" x2="393" y2="470" stroke="#555" stroke-width="1"/>
    <line x1="390" y1="492" x2="398" y2="492" stroke="#555" stroke-width="1"/>
    <line x1="350" y1="476" x2="343" y2="470" stroke="#555" stroke-width="1"/>
    <line x1="346" y1="492" x2="338" y2="492" stroke="#555" stroke-width="1"/>
    <line x1="386" y1="508" x2="393" y2="514" stroke="#777" stroke-width="1"/>
    <line x1="350" y1="508" x2="343" y2="514" stroke="#777" stroke-width="1"/>
    <text x="368" y="496" fill="#000" font-size="8" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="800" letter-spacing="0.04em">TUSHY</text>
    <text x="368" y="527" fill="#000" font-size="7" text-anchor="middle" font-family="Space Grotesk, sans-serif" font-weight="700">GRAND FLUSH FINALE</text>
    <text x="368" y="455" fill="#999" font-size="5.5" text-anchor="middle" font-family="Inter, sans-serif">&#9321; FINALE</text>
  </g>

  <!-- GUEST WALKPATH ‚Äî U-shape: Greeter ‚Üí right along top ‚Üí down right wall ‚Üí left along bottom ‚Üí into BA zone -->
  <!-- Clear of all stations: top at y=195, right at x=880, bottom at y=420 -->
  <path d="
    M 130,140
    L 130,165
    C 130,190 150,195 270,195
    L 860,195
    C 878,195 885,210 885,225
    L 885,395
    C 885,415 872,420 855,420
    L 270,420
    C 240,420 220,425 220,445
    L 220,460
  " fill="none" stroke="#bbb" stroke-width="1.5" stroke-dasharray="6,4" opacity="0.5"/>
  <!-- U-shape labels -->
  <text x="530" y="188" fill="#bbb" font-size="4" text-anchor="middle" font-family="Inter, sans-serif" letter-spacing="0.08em">GUEST WALKPATH &rarr;</text>
  <text x="896" y="310" fill="#bbb" font-size="4" text-anchor="middle" font-family="Inter, sans-serif" transform="rotate(90,896,310)" letter-spacing="0.08em">WALKPATH &darr;</text>
  <text x="560" y="432" fill="#bbb" font-size="4" text-anchor="middle" font-family="Inter, sans-serif" letter-spacing="0.08em">&larr; WALKPATH TO BA</text>
  <!-- Direction arrows along path -->
  <path d="M380,195 L395,195" fill="none" stroke="#bbb" stroke-width="1" marker-end="url(#arr)" opacity="0.4"/>
  <path d="M720,195 L735,195" fill="none" stroke="#bbb" stroke-width="1" marker-end="url(#arr)" opacity="0.4"/>
  <path d="M885,275 L885,290" fill="none" stroke="#bbb" stroke-width="1" marker-end="url(#arr)" opacity="0.4"/>
  <path d="M700,420 L685,420" fill="none" stroke="#bbb" stroke-width="1" marker-end="url(#arr)" opacity="0.4"/>
  <path d="M400,420 L385,420" fill="none" stroke="#bbb" stroke-width="1" marker-end="url(#arr)" opacity="0.4"/>
  <!-- Arrow into BA zone -->
  <path d="M220,445 L220,455" fill="none" stroke="#bbb" stroke-width="1" marker-end="url(#arr)" opacity="0.4"/>

  <!-- PNEUMATIC RETURN -->
  <line x1="230" y1="460" x2="230" y2="140" stroke="#999" stroke-width="1.5" stroke-dasharray="5,4" opacity="0.3"/>
  <text x="222" y="300" fill="#bbb" font-size="4.5" text-anchor="middle" font-family="Inter, sans-serif" transform="rotate(-90,222,300)">PNEUMATIC RETURN &uarr;</text>

  <!-- WATER CHANNEL ‚Äî full perimeter (THE ONE COLOR ELEMENT) -->
  <!-- Channel background (subtle fill tracing the perimeter) -->
  <path d="
    M 225,142
    L 985,142
    C 998,142 1000,155 1000,160
    L 1000,448
    C 1000,458 992,460 985,460
    L 225,460
  " fill="none" stroke="rgba(79,195,247,0.25)" stroke-width="5" stroke-linecap="round"/>
  <!-- Animated water flow line -->
  <path d="
    M 225,142
    L 985,142
    C 998,142 1000,155 1000,160
    L 1000,448
    C 1000,458 992,460 985,460
    L 225,460
  " fill="none" class="water-flow" stroke="#0288D1" stroke-width="2" opacity="0.5" stroke-linecap="round"/>
  <!-- Labels -->
  <text x="610" y="155" fill="#0277BD" font-size="4.5" text-anchor="middle" font-family="Inter, sans-serif" opacity="0.6">WATER CHANNEL &rarr;</text>
  <text x="1007" y="300" fill="#0277BD" font-size="4" text-anchor="middle" font-family="Inter, sans-serif" opacity="0.5" transform="rotate(90,1007,300)">&darr; WATER</text>
  <text x="610" y="472" fill="#0277BD" font-size="4.5" text-anchor="middle" font-family="Inter, sans-serif" opacity="0.5">&larr; WATER RETURN</text>

</svg>
</div><!-- .map-viewport -->

<!-- Key Highlights -->
<div style="margin-top:48px;">
  <h2 style="font-family:'Space Grotesk',sans-serif;font-size:1.1rem;font-weight:600;color:#999;letter-spacing:0.12em;text-transform:uppercase;margin:0 0 20px;text-align:center;">Key Highlights</h2>
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;">
    <div style="background:#f8f8f8;border:1px solid #e5e5e5;border-radius:10px;padding:20px;">
      <div style="font-size:1.5rem;margin-bottom:8px;">üí¶</div>
      <h3 style="font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;margin:0 0 6px;">Closed-Loop Water System</h3>
      <p style="font-size:0.85rem;color:#666;line-height:1.5;margin:0;">A continuous water channel runs the perimeter, feeding every bidet. Everything recirculates ‚Äî water flows, drains, filters, and flows again.</p>
    </div>
    <div style="background:#f8f8f8;border:1px solid #e5e5e5;border-radius:10px;padding:20px;">
      <div style="font-size:1.5rem;margin-bottom:8px;">üïπÔ∏è</div>
      <h3 style="font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;margin:0 0 6px;">Interactive Stations</h3>
      <p style="font-size:0.85rem;color:#666;line-height:1.5;margin:0;">Visitors actively participate ‚Äî pressing buttons, pulling levers, and triggering mechanisms to keep the chain reaction going.</p>
    </div>
    <div style="background:#f8f8f8;border:1px solid #e5e5e5;border-radius:10px;padding:20px;">
      <div style="font-size:1.5rem;margin-bottom:8px;">üîÑ</div>
      <h3 style="font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;margin:0 0 6px;">Continuous Loop</h3>
      <p style="font-size:0.85rem;color:#666;line-height:1.5;margin:0;">The machine runs on a loop. Gravity return track brings the jumbo ball back to Station 1. Each run takes ~3 minutes.</p>
    </div>
    <div style="background:#f8f8f8;border:1px solid #e5e5e5;border-radius:10px;padding:20px;">
      <div style="font-size:1.5rem;margin-bottom:8px;">üõçÔ∏è</div>
      <h3 style="font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;margin:0 0 6px;">Full Product Showcase</h3>
      <p style="font-size:0.85rem;color:#666;line-height:1.5;margin:0;">Every TUSHY product featured: bidets, ottomans, TP, candles, brushes, towels, sprays. Brand activation zone at exit for demos and sales.</p>
    </div>
    <div style="background:#f8f8f8;border:1px solid #e5e5e5;border-radius:10px;padding:20px;">
      <div style="font-size:1.5rem;margin-bottom:8px;">üì∏</div>
      <h3 style="font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;margin:0 0 6px;">Photo-Worthy Moments</h3>
      <p style="font-size:0.85rem;color:#666;line-height:1.5;margin:0;">Every station designed for social sharing. Dramatic reveals, colorful splashes, and satisfying chain reactions that beg to be filmed.</p>
    </div>
    <div style="background:#f8f8f8;border:1px solid #e5e5e5;border-radius:10px;padding:20px;">
      <div style="font-size:1.5rem;margin-bottom:8px;">‚ú®</div>
      <h3 style="font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;margin:0 0 6px;">Multi-Sensory Experience</h3>
      <p style="font-size:0.85rem;color:#666;line-height:1.5;margin:0;">Sight, sound, touch, scent, and water. Candles release fragrance, water splashes, balls roll and clunk ‚Äî a full sensory journey.</p>
    </div>
  </div>
</div>

</div><!-- .presentation -->

<!-- Station Popup (appears on map click) -->
<div class="station-popup" id="stationPopup">
  <div class="station-popup-header">
    <span class="station-popup-num" id="popupStationNum">Station 1</span>
    <button class="station-popup-close" id="popupClose">√ó</button>
  </div>
  <div id="popupCategory" style="font-size:0.7rem;color:#007AFF;text-transform:uppercase;letter-spacing:0.08em;margin-bottom:6px;"></div>
  <h3 id="popupTitle">The Great Cascade</h3>
  <p id="popupDesc">Description here...</p>
  <div class="station-popup-actions">
    <button class="station-popup-btn primary" id="popupSwapBtn">Swap Idea</button>
  </div>
</div>

<!-- Ideas Panel Overlay -->
<div class="ideas-overlay" id="ideasOverlay"></div>

<!-- Ideas Panel (slides in from right) -->
<div class="ideas-panel" id="ideasPanel">
  <div class="ideas-panel-header">
    <h2>Ideas Library</h2>
    <button class="ideas-panel-close" id="closeIdeasBtn">√ó</button>
  </div>
  <div class="ideas-panel-body" id="ideasPanelBody">
    <!-- Ideas will be rendered here -->
  </div>
  <div class="ideas-panel-footer">
    <button class="ideas-btn" style="width:100%;" id="addIdeaBtnPanel">+ Add New Idea</button>
  </div>
</div>

<!-- Hidden data containers -->
<div class="hidden">
<div id="station-cards">

  <div class="feature-card" data-sid="1">
    <div class="station-num">&#9312; Start &middot; Top Wall</div>
    <h3>The Great Cascade</h3>
    <p>A TUSHY Classic 3.0 mounted on a real toilet fires a jet of water that launches the üí© jumbo ball down the first ramp. Water feeds into the recirculating acrylic channel along the top wall. Return track from Finale drops ball back into starting position.</p>
    <div class="products-used">
      <span class="product-tag">Classic 3.0</span>
      <span class="product-tag">Spa 3.0</span>
      <span class="product-tag">Fresh</span>
      <span class="product-tag mechanic">gravity return track</span>
    </div>
  </div>

  <div class="feature-card" data-sid="2">
    <div class="station-num">&#9313; Top Wall</div>
    <h3>The Bamboo Grove</h3>
    <p>Dense grove of real green bamboo poles with TUSHY Bamboo TP rolls and fabric (cut to look like giant TP rolls). Jumbo ball weaves through, triggering TP to unroll from poles like scrolls &mdash; counterweights that lower bridges and release gates.</p>
    <div class="products-used">
      <span class="product-tag">Bamboo TP</span>
      <span class="product-tag">TUSHY Stand</span>
      <span class="product-tag">Tissues / Squares</span>
      <span class="product-tag mechanic">motorized rewind</span>
    </div>
  </div>

  <div class="feature-card" data-sid="3">
    <div class="station-num">&#9314; &#x270B; Interactive &middot; Top Wall</div>
    <h3>The Spray Gate</h3>
    <p>Jumbo ball jams behind a translucent gate. Visitors press a lit arcade button that triggers real wall-mounted bidets (Classic 3.0 + Spa 3.0) to spray the gate clean. Counterweighted gate swings open.</p>
    <div class="products-used">
      <span class="product-tag interactive">Arcade Button &rarr; Bidet</span>
      <span class="product-tag">Classic 3.0</span>
      <span class="product-tag">Spa 3.0</span>
      <span class="product-tag mechanic">counterweight return</span>
    </div>
  </div>

  <div class="feature-card" data-sid="4">
    <div class="station-num">&#9315; Top Wall</div>
    <h3>The Ottoman Staircase</h3>
    <p>Descending staircase of TUSHY Ottoman Original (9") stools. Jumbo ball bounces down each padded step, compressing the padding and springing forward. Final Ottoman triggers a seesaw lever.</p>
    <div class="products-used">
      <span class="product-tag">Ottoman Original (9")</span>
      <span class="product-tag mechanic">spring-loaded surfaces</span>
    </div>
  </div>

  <div class="feature-card" data-sid="5">
    <div class="station-num">&#9316; Corner</div>
    <h3>Candle Lane</h3>
    <p>A corridor of TUSHY candles &mdash; Morning Zest, Late Bloomer, Evening Wood, Midnight Ash. LED bulbs simulate warm flickering flame. Jumbo ball rolls over pressure plates, triggering LEDs in sequence. Room Spray misters release scent zones.</p>
    <p style="margin-top:10px;padding:10px 12px;background:#fefce8;border:1px solid #fef08a;border-radius:6px;font-size:0.82rem;color:#854d0e;"><strong>Option:</strong> Real flames using torch igniters or electric ignition. Mini üí© balls trigger vacuum tubes that extinguish flames and pull smoke away. More dramatic but requires fire safety measures.</p>
    <div class="products-used">
      <span class="product-tag">Candles (all 4)</span>
      <span class="product-tag">Room Spray</span>
      <span class="product-tag">Toilet Spray</span>
      <span class="product-tag mechanic">LED + pressure plates</span>
    </div>
  </div>

  <div class="feature-card" data-sid="6">
    <div class="station-num">&#9317; &#x270B; Interactive &middot; Right Wall</div>
    <h3>The Great Unroll</h3>
    <p>Giant spool of fabric (cut to look like a giant TP roll) mounted on the wall. Visitors physically pull it &mdash; acts as a pulley rope lifting a gate and releasing the jumbo ball. Fabric streams across the room.</p>
    <div class="products-used">
      <span class="product-tag interactive">Fabric TP spool (pull)</span>
      <span class="product-tag">TUSHY Stand</span>
      <span class="product-tag mechanic">motorized rewind (~90s)</span>
    </div>
  </div>

  <div class="feature-card" data-sid="7">
    <div class="station-num">&#9318; Right Wall</div>
    <h3>The Ball Wash</h3>
    <p>TUSHY Toilet Brushes with coconut husk scrubbing pads become spinning paddle wheels. Jumbo ball enters a cleaning gauntlet lined with Bum Towels that dry it off. Lemon + tea tree scent. Runs continuously.</p>
    <div class="products-used">
      <span class="product-tag">Toilet Brush</span>
      <span class="product-tag">Scrubbing Pads</span>
      <span class="product-tag">Bum Towels</span>
      <span class="product-tag mechanic">always running</span>
    </div>
  </div>

  <div class="feature-card" data-sid="8">
    <div class="station-num">&#9319; &#x270B; Interactive &middot; Bottom Wall</div>
    <h3>The Throne Stomp</h3>
    <p>TUSHY Ottoman with a pressure plate. Visitor steps on it to release the jumbo ball into the final stretch. Display TUSHY Ace / Aura as the "Royal Throne."</p>
    <div class="products-used">
      <span class="product-tag interactive">Ottoman (pressure plate)</span>
      <span class="product-tag">Ace 2.0</span>
      <span class="product-tag">Aura</span>
      <span class="product-tag mechanic">spring plate return</span>
    </div>
  </div>

  <div class="feature-card" data-sid="9">
    <div class="station-num">&#9320; &#x270B; + Machine &middot; Bottom Wall</div>
    <h3>The Bidet Symphony</h3>
    <p>10 real bidets with Arduino-controlled solenoids play water choreography to classical music. Jumbo ball triggers each bidet in sequence &mdash; like a music box made of water. Between runs, visitors freestyle with an arcade button console. Screen loops the original TUSHY commercial.</p>
    <div class="products-used">
      <span class="product-tag interactive">10 Arcade Buttons</span>
      <span class="product-tag">10&times; Bidet Units</span>
      <span class="product-tag">Arduino + Solenoids</span>
      <span class="product-tag mechanic">solenoid auto-reset</span>
    </div>
  </div>

  <div class="feature-card" data-sid="10">
    <div class="station-num">&#9321; Finale &middot; Bottom Left</div>
    <h3>The Grand Flush Finale</h3>
    <p>Jumbo ball drops into a giant illuminated toilet bowl. Flush handle triggers synchronized LED light show and flush sound effect. Bowl fills with dozens of mini üí© balls that swirl and drain. TUSHY logo blazes. Return track guides jumbo ball back to Station 1.</p>
    <div class="products-used">
      <span class="product-tag">Display toilet</span>
      <span class="product-tag">LED strip lighting</span>
      <span class="product-tag">Mini üí© balls</span>
      <span class="product-tag mechanic">gravity return track</span>
    </div>
  </div>

</div>

<div class="section-label">BRAND ACTIVATION &mdash; EXIT EXPERIENCE</div>
<div class="features">
  <div class="feature-card">
    <div class="station-num">Welcome</div>
    <h3>Entrance + Greeter</h3>
    <p>Visitors enter through an archway at the top of the left wall. A door person / brand ambassador welcomes guests and gives a brief overview before directing them into the installation.</p>
  </div>
  <div class="feature-card">
    <div class="station-num">Exit Flow</div>
    <h3>Brand Activation Walkthrough</h3>
    <p>After Station 10, visitors enter the BA zone. Browsing upward: Accessories Wall, Scent Bar, Retail + Merch, Bidet Demo stations (try every model), and the Golden Throne photo op as the final moment before exit.</p>
  </div>
  <div class="feature-card">
    <div class="station-num">Photo Op &middot; Last Stop</div>
    <h3>The Golden Throne</h3>
    <p>Gold-leafed display toilet with a TUSHY Aura installed. Branded backdrop, ring light, hashtag signage. Last stop before exit &mdash; every visitor leaves with a shareable photo.</p>
  </div>
</div>

<!-- IDEA CATALOG -->
<div class="section-label">IDEAS</div>
<div id="idea-cards">

  <div class="feature-card idea-card">
    <div class="station-num">Finale Option</div>
    <h3>The Water Curtain</h3>
    <p>Thin sheet of water falls from a ceiling-mounted bar. Ball breaks through it like a finish line. TUSHY logo projects onto the water curtain from behind. Visitors see the logo materialize in water, then it collapses into the drain. Pure spectacle, zero bidet overlap with the Symphony.</p>
    <div class="products-used"><span class="product-tag mechanic">water pump + bar</span><span class="product-tag mechanic">projector</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Finale Option</div>
    <h3>The TP Avalanche</h3>
    <p>Ball triggers a release mechanism holding hundreds of TP rolls stacked floor-to-ceiling behind a gate. Gate drops, rolls cascade down a ramp in a satisfying avalanche. Sound system plays a thunderous flush. Fabric TP streamers unfurl from the ceiling. Purely mechanical &mdash; no water.</p>
    <div class="products-used"><span class="product-tag">Bamboo TP (bulk)</span><span class="product-tag">Fabric TP streamers</span><span class="product-tag mechanic">gravity release gate</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Finale Option</div>
    <h3>The Giant Flush Handle</h3>
    <p>Oversized toilet flush lever (6 ft tall). Ball lands on the lever arm, its weight pushes it down. This triggers: lights sweep, sound system plays a cinematic flush, and a single dramatic water cannon fires a geyser straight up. One big moment, not a sequence.</p>
    <div class="products-used"><span class="product-tag mechanic">custom lever</span><span class="product-tag mechanic">single water cannon</span><span class="product-tag mechanic">lighting rig</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Finale Option</div>
    <h3>The Domino Wall</h3>
    <p>200+ TP rolls standing upright on a tilted shelf. Ball knocks the first one and they domino across the entire back wall in a wave. Each roll is color-banded (white + TUSHY blue tape) creating a visual pattern as they fall. Auto-reset via motorized tilt shelf that stands them all back up.</p>
    <div class="products-used"><span class="product-tag">Bamboo TP &times;200+</span><span class="product-tag mechanic">motorized tilt shelf</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Finale Option</div>
    <h3>The Fog Reveal</h3>
    <p>Ball enters a dark chamber. Fog fills the space. Then LEDs punch through the fog tracing the TUSHY logo in light. Scent misters (Room Spray) activate so the finale smells incredible. Ball rolls out the other side into a catch net. Atmospheric, sensory, memorable.</p>
    <div class="products-used"><span class="product-tag">Room Spray</span><span class="product-tag">Toilet Spray</span><span class="product-tag mechanic">fog machine + LEDs</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Finale Option</div>
    <h3>The Ramp Drop</h3>
    <p>Ball rolls off a high ramp and drops 8+ feet into a bullseye splash pool below. Impact triggers a gong/bell and a ring of LED lights. Simple, visceral, crowd-pleaser. The drop IS the finale &mdash; everyone watches the ball fall.</p>
    <div class="products-used"><span class="product-tag mechanic">elevated ramp</span><span class="product-tag mechanic">splash pool + drain</span><span class="product-tag mechanic">gong / bell</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Feature</div>
    <h3>The Brush Xylophone</h3>
    <p>Row of TUSHY Toilet Brushes mounted at different heights. Ball rolls across the handles, each one makes a different pitched sound (tuned with weights). Creates a melody as the ball passes. Could replace or combine with the Scrub Zone.</p>
    <div class="products-used"><span class="product-tag">Toilet Brush &times;8+</span><span class="product-tag mechanic">tuned weights</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Feature</div>
    <h3>The Candle Snuff</h3>
    <p>LED candles are all "lit." Ball rolls past each one and knocks a small lever that flips a shade over the candle, snuffing it. The corridor goes dark as the ball passes through. Last candle triggers the next station. Dramatic lighting moment.</p>
    <div class="products-used"><span class="product-tag">Candles (all 4)</span><span class="product-tag mechanic">lever shades</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Feature</div>
    <h3>The Towel Zip Line</h3>
    <p>Ball lands on a Bum Towel hammock attached to a zip line wire. Towel slides down the wire carrying the ball across a gap (could span the width of the space). Ball drops off at the other end into the next station. Visual wow moment.</p>
    <div class="products-used"><span class="product-tag">Bum Towels</span><span class="product-tag mechanic">zip line wire + pulley</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Feature</div>
    <h3>The Spiral Drain</h3>
    <p>Large funnel/spiral (like a coin donation vortex). Ball enters the rim and spirals inward, picking up speed. Drops through the center hole into the next section. Mesmerizing to watch. Could be built from acrylic with TUSHY branding etched in.</p>
    <div class="products-used"><span class="product-tag mechanic">acrylic spiral funnel</span><span class="product-tag mechanic">TUSHY etching</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Feature</div>
    <h3>The Cat's Cradle</h3>
    <p>A web of taut ropes woven in a cat's cradle pattern. Ball enters and bounces between the elastic strings, redirecting unpredictably before dropping through the center. Each pass creates different paths. Hypnotic to watch.</p>
    <div class="products-used"><span class="product-tag mechanic">elastic rope web</span><span class="product-tag mechanic">frame structure</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Feature</div>
    <h3>The Toilet Seat See-Saw</h3>
    <p>Real toilet seat mounted as a see-saw/teeter-totter. Ball rolls onto one side, tips it, slides across and launches off the lifted end. Classic Rube Goldberg energy. Multiple seats could chain together.</p>
    <div class="products-used"><span class="product-tag mechanic">toilet seat pivot</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Interactive Option</div>
    <h3>The Bidet Dunk Tank</h3>
    <p>Visitor hits a target (arcade button or thrown ball). Direct hit triggers a bidet mounted above a clear tank, filling it with water. When the tank fills to a line, the weight tips a gate releasing the jumbo ball. Carnival energy.</p>
    <div class="products-used"><span class="product-tag interactive">Arcade Button / throw</span><span class="product-tag">Classic 3.0</span><span class="product-tag mechanic">weight-triggered gate</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Interactive Option</div>
    <h3>The Tug of TP</h3>
    <p>Two visitors each grab an end of a long fabric TP strip and pull in opposite directions (tug of war). The pull raises a platform in the middle via pulley, lifting the ball to the next level. Cooperative moment &mdash; takes two people.</p>
    <div class="products-used"><span class="product-tag interactive">2-person pull</span><span class="product-tag">Fabric TP</span><span class="product-tag mechanic">dual pulley lift</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Interactive Option</div>
    <h3>The Spin Cycle</h3>
    <p>Large wheel (like Wheel of Fortune) with Scrubbing Pads as grip texture. Visitor spins it. The wheel's rotation powers a belt that moves the ball forward along a track. Faster spin = faster ball. Satisfying physical interaction.</p>
    <div class="products-used"><span class="product-tag interactive">Spin wheel</span><span class="product-tag">Scrubbing Pads</span><span class="product-tag mechanic">belt drive</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Interactive Option</div>
    <h3>The Stomp Pad Drum Kit</h3>
    <p>4 Ottomans on the floor, each wired to a different sound + action. Visitor stomps them in the right sequence (shown on a display) to open a gate. Wrong sequence = funny buzzer. Gets the crowd involved, game-show energy.</p>
    <div class="products-used"><span class="product-tag interactive">4&times; Ottoman (pressure pads)</span><span class="product-tag mechanic">sequence logic + display</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Kinetic / Always-On</div>
    <h3>The Water Wheel Wall</h3>
    <p>Vertical wall with 5&ndash;6 water wheels at different sizes, fed by the recirculating channel. Always spinning. Ball rides one wheel up, drops to the next, rides it across. Mesmerizing perpetual motion. Works even between runs.</p>
    <div class="products-used"><span class="product-tag mechanic">water wheels (acrylic)</span><span class="product-tag mechanic">water channel fed</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Kinetic / Always-On</div>
    <h3>The TP Roll Conveyor</h3>
    <p>Dozens of TP rolls mounted side by side as rollers (like a roller conveyor). Ball rolls across them. The rolls spin freely &mdash; satisfying visual of all the rolls turning in unison. Always ready, no reset needed.</p>
    <div class="products-used"><span class="product-tag">Bamboo TP (mounted)</span><span class="product-tag mechanic">free-spin axles</span></div>
  </div>

  <div class="feature-card">
    <div class="station-num">Sensory</div>
    <h3>The Scent Tunnel</h3>
    <p>Enclosed walkthrough tunnel (fabric walls). Ball triggers misters inside that release the 4 candle scents in zones: Morning Zest &rarr; Late Bloomer &rarr; Evening Wood &rarr; Midnight Ash. Visitors walk through the scent journey while the ball travels overhead on a rail.</p>
    <div class="products-used"><span class="product-tag">Candles (scent only)</span><span class="product-tag">Room Spray</span><span class="product-tag mechanic">overhead rail</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Sensory</div>
    <h3>The Sound Bath</h3>
    <p>Ball passes through a chamber where it strikes different materials &mdash; metal bowls, wood blocks, water surfaces &mdash; creating ambient tones. Each TUSHY product category has its own sound signature. Meditative contrast to the high-energy stations.</p>
    <div class="products-used"><span class="product-tag mechanic">tuned surfaces</span><span class="product-tag mechanic">contact mics + speakers</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Sensory</div>
    <h3>The Temperature Wave</h3>
    <p>Corridor with alternating warm and cool air zones. Ball triggers fans as it passes &mdash; first a warm breeze (like a heated bidet), then a cool mist. Visitors feel the contrast on their skin. Subtle but memorable sensory moment.</p>
    <div class="products-used"><span class="product-tag">Spa 3.0 (warm water concept)</span><span class="product-tag mechanic">heat lamps</span><span class="product-tag mechanic">cool mist fans</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Sensory</div>
    <h3>The Tactile Wall</h3>
    <p>Interactive wall with different textures visitors can touch: smooth ceramic (toilet), soft bamboo fibers (TP), cool metal (bidet nozzle), plush towel. Ball rolling past illuminates each texture zone. Engages touch in a bathroom context.</p>
    <div class="products-used"><span class="product-tag">Bamboo TP</span><span class="product-tag">Bum Towels</span><span class="product-tag mechanic">texture panels + LED strips</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Sensory</div>
    <h3>The Whisper Chamber</h3>
    <p>Sound-dampened alcove. Ball enters and triggers ASMR-style audio: gentle water sounds, soft paper rustling, quiet spray mist. Visitors step in and experience unexpected calm. Contrast station before or after high-energy segments.</p>
    <div class="products-used"><span class="product-tag mechanic">acoustic panels</span><span class="product-tag mechanic">directional speakers</span><span class="product-tag">Room Spray (light mist)</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Sensory</div>
    <h3>The Light Spectrum</h3>
    <p>Ball passes through a prism-like structure that casts rainbow light across the space. As it moves, the colors shift and dance on walls and visitors. Pure visual delight &mdash; no products, just light art inspired by water refraction.</p>
    <div class="products-used"><span class="product-tag mechanic">dichroic glass panels</span><span class="product-tag mechanic">motorized spot lights</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Kinetic / Always-On</div>
    <h3>The Ball Multiplier</h3>
    <p>Jumbo ball hits a trigger that releases a cascade of 20+ mini üí© balls from an overhead hopper. They scatter down multiple parallel tracks, creating a visual spectacle. Mini balls collect in a basin below and are manually returned to the hopper between runs.</p>
    <div class="products-used"><span class="product-tag">Mini üí© balls &times;50</span><span class="product-tag mechanic">release hopper</span><span class="product-tag mechanic">parallel tracks</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Kinetic / Always-On</div>
    <h3>The Pinball Pop</h3>
    <p>Enclosed pinball-style chamber with pegs. Jumbo ball enters and bounces between pegs while releasing mini üí© balls from spring-loaded chambers. The mini balls rain down and collect at the bottom. Chaotic, playful energy. Visible through clear acrylic.</p>
    <div class="products-used"><span class="product-tag">Mini üí© balls &times;30</span><span class="product-tag mechanic">acrylic chamber</span><span class="product-tag mechanic">spring releases</span></div>
  </div>

  <div class="feature-card" data-core="true">
    <div class="station-num">Finale Option</div>
    <h3>The Hindsight Station</h3>
    <p>Mini üí© balls from the finale roll past a camera that "analyzes" them using the TUSHY Hindsight app interface on a big screen. Each ball gets a fake health reading ‚Äî hydration level, fiber score, emoji rating. Visitors watch the absurd analysis in real-time. QR code prompts them to download the real app.</p>
    <div class="products-used"><span class="product-tag">Hindsight App</span><span class="product-tag">Mini üí© balls</span><span class="product-tag mechanic">camera + display</span><span class="product-tag mechanic">custom software</span></div>
  </div>

  <!-- User ideas will be inserted here -->
  <div id="user-ideas-container"></div>

  <!-- Add Idea Card -->
  <div class="add-idea-card" id="add-idea-btn">
    <div class="plus-icon">+</div>
    <h3>Add Your Idea</h3>
    <p>Submit a new concept</p>
  </div>

</div><!-- #idea-cards -->
</div><!-- .hidden data containers -->

<!-- Add Idea Modal -->
<div class="idea-modal-overlay" id="idea-modal">
  <div class="idea-modal">
    <div class="idea-modal-header">
      <h3>Add New Idea</h3>
      <button class="idea-modal-close" id="idea-modal-close">&times;</button>
    </div>
    <div class="idea-modal-body">
      <div class="idea-form-group">
        <label>Title</label>
        <input type="text" id="idea-title" placeholder="e.g., The Water Curtain" autocomplete="off" autocorrect="off" spellcheck="false" data-lpignore="true" data-1p-ignore data-form-type="other">
      </div>
      <div class="idea-form-group">
        <label>Description</label>
        <textarea id="idea-desc" placeholder="Describe the idea, how it works, what makes it special..." autocomplete="off" spellcheck="false" data-lpignore="true" data-1p-ignore data-form-type="other"></textarea>
      </div>
      <div class="idea-form-row">
        <div class="idea-form-group">
          <label>Category</label>
          <div class="category-select" id="category-select">
            <div class="category-selected" id="category-selected">
              <span class="cat-icon">üèÅ</span>
              <span class="cat-label">Finale Option</span>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            </div>
            <div class="category-options" id="category-options">
              <div class="category-option" data-value="Finale Option"><span class="cat-icon">üèÅ</span>Finale Option</div>
              <div class="category-option" data-value="Interactive Option"><span class="cat-icon">üïπÔ∏è</span>Interactive Option</div>
              <div class="category-option" data-value="Sensory"><span class="cat-icon">‚ú®</span>Sensory</div>
              <div class="category-option" data-value="Water Feature"><span class="cat-icon">üí¶</span>Water Feature</div>
              <div class="category-option" data-value="Kinetic / Always-On"><span class="cat-icon">‚öôÔ∏è</span>Kinetic / Always-On</div>
              <div class="category-option" data-value="Feature"><span class="cat-icon">‚≠ê</span>Feature</div>
            </div>
            <input type="hidden" id="idea-category" value="Finale Option">
          </div>
        </div>
        <div class="idea-form-group emoji-group">
          <label>Emoji</label>
          <div class="emoji-picker" id="emoji-picker">
            <div class="emoji-selected" id="emoji-selected">üíß</div>
            <div class="emoji-grid" id="emoji-grid">
              <span data-emoji="üíß">üíß</span><span data-emoji="üöø">üöø</span><span data-emoji="üí¶">üí¶</span><span data-emoji="üåä">üåä</span>
              <span data-emoji="üßª">üßª</span><span data-emoji="üöΩ">üöΩ</span><span data-emoji="ü™†">ü™†</span><span data-emoji="üßº">üßº</span>
              <span data-emoji="üïØÔ∏è">üïØÔ∏è</span><span data-emoji="üî•">üî•</span><span data-emoji="üí®">üí®</span><span data-emoji="‚ú®">‚ú®</span>
              <span data-emoji="üéØ">üéØ</span><span data-emoji="üèÅ">üèÅ</span><span data-emoji="üé™">üé™</span><span data-emoji="üé≠">üé≠</span>
              <span data-emoji="üîî">üîî</span><span data-emoji="üéµ">üéµ</span><span data-emoji="ü•Å">ü•Å</span><span data-emoji="üéπ">üéπ</span>
              <span data-emoji="‚öôÔ∏è">‚öôÔ∏è</span><span data-emoji="üîÑ">üîÑ</span><span data-emoji="‚ö°">‚ö°</span><span data-emoji="üí°">üí°</span>
              <span data-emoji="üåà">üåà</span><span data-emoji="üåÄ">üåÄ</span><span data-emoji="‚¨áÔ∏è">‚¨áÔ∏è</span><span data-emoji="ü™Ç">ü™Ç</span>
              <span data-emoji="üëÉ">üëÉ</span><span data-emoji="üëÅÔ∏è">üëÅÔ∏è</span><span data-emoji="‚úã">‚úã</span><span data-emoji="ü§ù">ü§ù</span>
            </div>
          </div>
          <input type="hidden" id="idea-emoji" value="üíß">
        </div>
      </div>
      <div class="idea-form-group">
        <label>Your Name</label>
        <input type="text" id="idea-author" placeholder="e.g., Chris" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-lpignore="true" data-1p-ignore data-form-type="other">
      </div>
    </div>
    <div class="idea-modal-footer">
      <button class="idea-modal-btn secondary" id="idea-cancel">Cancel</button>
      <button class="idea-modal-btn primary" id="idea-save">Save Idea</button>
    </div>
  </div>
</div>

<!-- COST ESTIMATES -->
<div class="walkthrough-content">
<div class="section-label">CONCEPTUAL COST ESTIMATE</div>
<div class="cost-section">
  <div class="cost-disclaimer">
    <strong>&#x26A0; Conceptual Estimate Only.</strong> Rough order-of-magnitude based on publicly listed retail prices (early 2026). Actual costs vary with vendor negotiations, bulk discounts, local labor rates, and design refinements. Starting point for budgeting &mdash; not a formal bid.
  </div>

  <div class="cost-total">
    <div class="amount">$30,000 &ndash; $50,000</div>
    <div class="label">Estimated Total (Conceptual)</div>
  </div>

  <!-- TUSHY Products -->
  <details class="cost-category">
    <summary>
      <span>TUSHY Products (provided by TUSHY)</span>
      <span class="cost-subtotal">$0</span>
    </summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name" style="color:#999;font-style:italic">All TUSHY products donated by TUSHY for the installation</span><span class="cost-item-qty">&mdash;</span><span class="cost-item-price" style="color:#999">$0</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://hellotushy.com/products/classic-affordable-bidet" target="_blank">Classic 3.0</a> &times;8, <a href="https://hellotushy.com/products/warm-water-bidet-tushy-spa" target="_blank">Spa 3.0</a> &times;4, <a href="https://hellotushy.com/products/tushy-fresh" target="_blank">Fresh</a> &times;2, <a href="https://hellotushy.com/products/ace-electric-bidet" target="_blank">Ace 2.0</a>, <a href="https://hellotushy.com/products/tushy-aura-luxury-bidet-seat" target="_blank">Aura</a>, <a href="https://hellotushy.com/products/non-electric-bidet" target="_blank">Wave</a></span><span class="cost-item-qty">bidets</span><span class="cost-item-price" style="color:#999">incl.</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://hellotushy.com/products/tushy-ottoman-toilet-stool" target="_blank">Ottoman Original 9"</a> &times;8, <a href="https://hellotushy.com/products/ottoman-go-toilet-stool" target="_blank">Ottoman Go</a> &times;2</span><span class="cost-item-qty">stools</span><span class="cost-item-price" style="color:#999">incl.</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://hellotushy.com/products/premium-bamboo-toilet-paper-36-rolls" target="_blank">Bamboo TP</a> &times;6 packs, <a href="https://hellotushy.com/products/tushy-tissues-24-pack" target="_blank">Tissues</a> &times;3, <a href="https://hellotushy.com/products/bidet-towels" target="_blank">Bum Towels</a> &times;3, <a href="https://hellotushy.com/products/tushy-stand" target="_blank">TUSHY Stand</a> &times;2</span><span class="cost-item-qty">paper &amp; acc.</span><span class="cost-item-price" style="color:#999">incl.</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://hellotushy.com/products/bathroom-candle" target="_blank">Candles</a> &times;12, <a href="https://hellotushy.com/products/tushy-toilet-brush-2-0" target="_blank">Toilet Brush</a> &times;4, <a href="https://hellotushy.com/products/tushy-scrubbing-pads" target="_blank">Scrubbing Pads</a> &times;4, <a href="https://hellotushy.com/products/tushy-travel-bidet" target="_blank">Travel Bidet</a> &times;3</span><span class="cost-item-qty">scent &amp; clean</span><span class="cost-item-price" style="color:#999">incl.</span></div>
    </div>
  </details>

  <!-- Plumbing -->
  <details class="cost-category">
    <summary><span>Plumbing &amp; Water Systems</span><span class="cost-subtotal">~$2,300</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/s/NDS%20Spee-D%20Channel%20Drain" target="_blank">NDS Spee-D Channel Drain 4ft</a></span><span class="cost-item-qty">&times;15 @ $65</span><span class="cost-item-price">$975</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/s/submersible%20pump%20recirculating" target="_blank">Little Giant Submersible Pump</a></span><span class="cost-item-qty">&times;2 @ $110</span><span class="cost-item-price">$220</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/b/Plumbing-Pipes-Fittings/N-5yc1vZbqp8" target="_blank">PVC Pipe, Fittings &amp; Valves</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$350</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/s/200%20gallon%20water%20tank" target="_blank">200-Gallon Water Storage Tank</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$300</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=12v+solenoid+water+valve" target="_blank">12V Solenoid Water Valves</a></span><span class="cost-item-qty">&times;20 @ $10</span><span class="cost-item-price">$200</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/s/pvc%20tubing%20hose%20clamps" target="_blank">Tubing, Hose Clamps, Misc</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$250</span></div>
    </div>
  </details>

  <!-- Electronics -->
  <details class="cost-category">
    <summary><span>Electronics &amp; Controls</span><span class="cost-subtotal">~$860</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=arduino+mega+2560" target="_blank">Arduino Mega 2560 R3</a></span><span class="cost-item-qty">&times;3 @ $29</span><span class="cost-item-price">$87</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=30mm+led+arcade+button+illuminated" target="_blank">LED Arcade Buttons 30mm (10-pack)</a></span><span class="cost-item-qty">&times;2 @ $40</span><span class="cost-item-price">$80</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=16+channel+relay+module+12v" target="_blank">16-Channel Relay Module (12V)</a></span><span class="cost-item-qty">&times;2 @ $35</span><span class="cost-item-price">$70</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=12v+500w+switching+power+supply" target="_blank">12V 500W Switching Power Supply</a></span><span class="cost-item-qty">&times;3 @ $40</span><span class="cost-item-price">$120</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=electronics+wiring+kit+breadboard" target="_blank">Wiring, Breadboards &amp; Connectors</a></span><span class="cost-item-qty">&times;3 @ $35</span><span class="cost-item-price">$105</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=led+flame+effect+bulb+e26" target="_blank">LED Flickering Flame Bulbs (4-pack)</a></span><span class="cost-item-qty">&times;3 @ $20</span><span class="cost-item-price">$60</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=force+sensitive+resistor+FSR" target="_blank">Force Sensitive Resistors (FSR)</a></span><span class="cost-item-qty">&times;6 @ $9</span><span class="cost-item-price">$54</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=55+inch+4k+smart+tv" target="_blank">55" Display TV</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$280</span></div>
    </div>
  </details>

  <!-- Structural -->
  <details class="cost-category">
    <summary><span>Structural &amp; Fabrication</span><span class="cost-subtotal">~$3,600</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=bamboo+poles+8ft+natural" target="_blank">Bamboo Poles 8ft (25-pack)</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$150</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/s/pvc%20pipe%20rails%20track" target="_blank">PVC Rails (gravity return track, ~50ft)</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$150</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=poop+emoji+stress+ball" target="_blank">Mini üí© Balls (stress balls)</a></span><span class="cost-item-qty">&times;100 @ $2</span><span class="cost-item-price">$200</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=80+20+t-slot+aluminum+extrusion" target="_blank">80/20 T-Slot Aluminum Extrusion</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$1,500</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=clear+acrylic+plexiglass+sheet" target="_blank">Acrylic / Plexiglass Sheets</a></span><span class="cost-item-qty">&times;10 @ $30</span><span class="cost-item-price">$300</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=spring+loaded+hinges+self+closing" target="_blank">Spring Hinges &amp; Return Springs</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$200</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=iron+weight+plate" target="_blank">Counterweight Plates</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$100</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/b/Lumber-Composites/N-5yc1vZbqm7" target="_blank">Lumber, Ramp Materials &amp; Track</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$800</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.homedepot.com/b/Hardware/N-5yc1vZc21m" target="_blank">Misc Hardware (bolts, brackets, casters)</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$300</span></div>
    </div>
  </details>

  <!-- AV -->
  <details class="cost-category">
    <summary><span>AV, Sound &amp; Lighting</span><span class="cost-subtotal">~$600</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=portable+pa+speaker+system+700w" target="_blank">PA Speaker System (powered pair)</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$200</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=18+inch+ring+light+with+stand" target="_blank">18" LED Ring Light w/ Stand</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$80</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=led+strip+lights+rgb+100ft" target="_blank">LED Strip Lights RGB 100ft</a></span><span class="cost-item-qty">&times;2 @ $40</span><span class="cost-item-price">$80</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=track+lighting+kit+6+light+led" target="_blank">6-Head LED Track Lighting Kit</a></span><span class="cost-item-qty">&times;2 @ $90</span><span class="cost-item-price">$180</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=streaming+media+player" target="_blank">Media Player (video loop)</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$50</span></div>
    </div>
  </details>

  <!-- Decor -->
  <details class="cost-category">
    <summary><span>Decor &amp; Branded Elements</span><span class="cost-subtotal">~$2,750</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name">Giant TP Roll Fabric (custom cut &amp; sewn)</span><span class="cost-item-qty">custom</span><span class="cost-item-price">$500</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=gold+leaf+paint+spray" target="_blank">Gold Paint / Leaf (Golden Throne)</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$150</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=retractable+banner+stand+8ft+backdrop" target="_blank">Branded Backdrop (8ft retractable)</a></span><span class="cost-item-qty">&times;1</span><span class="cost-item-price">$300</span></div>
      <div class="cost-item"><span class="cost-item-name">Signage, Hashtag Displays &amp; Wayfinding</span><span class="cost-item-qty">custom</span><span class="cost-item-price">$400</span></div>
      <div class="cost-item"><span class="cost-item-name">Custom Bidet Box (arcade console)</span><span class="cost-item-qty">custom fab</span><span class="cost-item-price">$500</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=display+shelving+retail+store" target="_blank">Scent Bar Display Fixtures</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$300</span></div>
      <div class="cost-item"><span class="cost-item-name"><a href="https://www.amazon.com/s?k=retail+display+shelving+unit" target="_blank">Retail Display Shelving (BA zone)</a></span><span class="cost-item-qty">lot</span><span class="cost-item-price">$600</span></div>
    </div>
  </details>

  <!-- Labor -->
  <details class="cost-category">
    <summary><span>Labor &amp; Professional Services</span><span class="cost-subtotal">~$16,000</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name">Installation Crew (3 people &times; 5 days)</span><span class="cost-item-qty">$300/day ea</span><span class="cost-item-price">$4,500</span></div>
      <div class="cost-item"><span class="cost-item-name">Licensed Plumber (2 days)</span><span class="cost-item-qty">$1,000/day</span><span class="cost-item-price">$2,000</span></div>
      <div class="cost-item"><span class="cost-item-name">Electrician (power + inspection)</span><span class="cost-item-qty">1.5 days</span><span class="cost-item-price">$1,500</span></div>
      <div class="cost-item"><span class="cost-item-name">Electronics / Arduino Developer (3 days)</span><span class="cost-item-qty">$1,000/day</span><span class="cost-item-price">$3,000</span></div>
      <div class="cost-item"><span class="cost-item-name">Custom Fabrication Shop</span><span class="cost-item-qty">project</span><span class="cost-item-price">$5,000</span></div>
    </div>
  </details>

  <!-- Contingency -->
  <details class="cost-category">
    <summary><span>Contingency &amp; Miscellaneous</span><span class="cost-subtotal">~$5,900</span></summary>
    <div class="cost-items">
      <div class="cost-item"><span class="cost-item-name">Permits &amp; Event Insurance</span><span class="cost-item-qty">&mdash;</span><span class="cost-item-price">$2,000</span></div>
      <div class="cost-item"><span class="cost-item-name">Contingency Buffer (15%)</span><span class="cost-item-qty">15%</span><span class="cost-item-price">$3,900</span></div>
    </div>
  </details>

</div>
</div><!-- end hidden cost section -->

<div class="tooltip-overlay" id="tooltip"><div class="tt-title"></div><div class="tt-cat" style="font-size:0.7rem;color:#007AFF;text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px;"></div><div class="tt-desc"></div><div class="tt-hint" style="font-size:0.7rem;color:#999;margin-top:8px;font-style:italic;">Click for more info</div></div>


<script>
  // === UI ELEMENTS ===
  const ideasPanel = document.getElementById('ideasPanel');
  const ideasOverlay = document.getElementById('ideasOverlay');
  const ideasPanelBody = document.getElementById('ideasPanelBody');
  const openIdeasBtn = document.getElementById('openIdeasBtn');
  const closeIdeasBtn = document.getElementById('closeIdeasBtn');
  const addIdeaBtnPanel = document.getElementById('addIdeaBtnPanel');

  const stationPopup = document.getElementById('stationPopup');
  const popupStationNum = document.getElementById('popupStationNum');
  const popupTitle = document.getElementById('popupTitle');
  const popupDesc = document.getElementById('popupDesc');
  const popupSwapBtn = document.getElementById('popupSwapBtn');
  const popupClose = document.getElementById('popupClose');

  const stationDataContainer = document.getElementById('station-cards');

  // Default emojis for idea categories (user can override)
  // Unique contextual emoji for each idea (shown on map only)
  const ideaEmojis = {
    // Finale Options
    'The Water Curtain': 'üíß',
    'The TP Avalanche': 'üßª',
    'The Giant Flush Handle': 'üöΩ',
    'The Domino Wall': 'üÅ£',
    'The Fog Reveal': 'üí®',
    'The Ramp Drop': '‚¨áÔ∏è',
    // Features (alternatives)
    'The Brush Xylophone': 'üéµ',
    'The Candle Snuff': 'üïØÔ∏è',
    'The Towel Zip Line': 'ü™Ç',
    'The Spiral Drain': 'üåÄ',
    "The Cat's Cradle": 'ü™¢',
    'The Toilet Seat See-Saw': '‚öñÔ∏è',
    // Interactive Options
    'The Bidet Dunk Tank': 'üéØ',
    'The Tug of TP': 'ü§ù',
    'The Spin Cycle': 'üîÑ',
    'The Stomp Pad Drum Kit': 'ü•Å',
    // Water Features
    'The Water Wheel Wall': '‚öôÔ∏è',
    'The TP Roll Conveyor': 'üõ§Ô∏è',
    // Sensory
    'The Scent Tunnel': 'üëÉ',
    'The Sound Bath': 'üîî',
    'The Temperature Wave': 'üå°Ô∏è',
    'The Tactile Wall': '‚úã',
    'The Whisper Chamber': 'ü§´',
    'The Light Spectrum': 'üåà',
    // New additions
    'The Ball Multiplier': '‚úñÔ∏è',
    'The Pinball Pop': 'üé∞',
    'The Hindsight Station': 'üì±',
    // Default fallback
    'default': '‚≠ê'
  };

  function getIdeaEmoji(title) {
    return ideaEmojis[title] || ideaEmojis['default'];
  }
  const ideaDataContainer = document.getElementById('idea-cards');

  let currentStation = null;
  let swapMode = false;

  // === UNDO/REDO SYSTEM ===
  const undoStack = [];
  const redoStack = [];
  const MAX_UNDO = 50;

  function recordAction(type, data) {
    // Save current state for the affected station
    if (type === 'assign') {
      const stationCard = stationDataContainer.querySelector(`[data-sid="${data.stationNum}"]`);
      if (stationCard) {
        data.previousTitle = stationCard.querySelector('h3').textContent;
        data.previousDesc = stationCard.querySelector('p').textContent;
      }
    }
    undoStack.push({ type, data, timestamp: Date.now() });
    if (undoStack.length > MAX_UNDO) undoStack.shift();
    redoStack.length = 0; // Clear redo on new action
    updateUndoRedoButtons();
  }

  function undo() {
    if (undoStack.length === 0) return;
    const action = undoStack.pop();

    if (action.type === 'assign') {
      // Restore previous station content
      const stationCard = stationDataContainer.querySelector(`[data-sid="${action.data.stationNum}"]`);
      if (stationCard && action.data.previousTitle) {
        const currentTitle = stationCard.querySelector('h3').textContent;
        const currentDesc = stationCard.querySelector('p').textContent;
        stationCard.querySelector('h3').textContent = action.data.previousTitle;
        stationCard.querySelector('p').textContent = action.data.previousDesc;
        // Store current for redo
        action.data.redoTitle = currentTitle;
        action.data.redoDesc = currentDesc;

        // Also restore SVG map station
        const svgStation = document.querySelector(`.station[data-station="${action.data.stationNum}"]`);
        if (svgStation) {
          const icon = stationIcons[action.data.stationNum] || '‚ë©';
          svgStation.dataset.name = icon + ' ' + action.data.previousTitle;
          svgStation.dataset.desc = action.data.previousDesc;
          svgStation.classList.remove('has-idea');

          // Restore hidden illustration elements
          svgStation.querySelectorAll('.hidden-illustration').forEach(el => {
            el.classList.remove('hidden-illustration');
            el.removeAttribute('opacity');
          });

          // Remove the swapped title and emoji
          const swappedTitle = svgStation.querySelector('.swapped-title');
          if (swappedTitle) swappedTitle.remove();
          const emojiEl = svgStation.querySelector('.idea-emoji');
          if (emojiEl) emojiEl.remove();
        }
      }
    }

    redoStack.push(action);
    updateUndoRedoButtons();
  }

  function redo() {
    if (redoStack.length === 0) return;
    const action = redoStack.pop();

    if (action.type === 'assign') {
      const stationCard = stationDataContainer.querySelector(`[data-sid="${action.data.stationNum}"]`);
      if (stationCard && action.data.redoTitle) {
        stationCard.querySelector('h3').textContent = action.data.redoTitle;
        stationCard.querySelector('p').textContent = action.data.redoDesc;

        // Also update SVG map station
        const svgStation = document.querySelector(`.station[data-station="${action.data.stationNum}"]`);
        if (svgStation) {
          const icon = stationIcons[action.data.stationNum] || '‚ë©';
          svgStation.dataset.name = icon + ' ' + action.data.redoTitle;
          svgStation.dataset.desc = action.data.redoDesc;
          svgStation.classList.add('has-idea');

          // Hide ALL children except main background rect
          const mainRect = svgStation.querySelector('rect');
          Array.from(svgStation.children).forEach(child => {
            if (child === mainRect || child.classList.contains('mobile-info-icon') || child.classList.contains('idea-emoji') || child.classList.contains('swapped-title')) {
              return; // Keep these visible
            }
            child.classList.add('hidden-illustration');
            child.setAttribute('opacity', '0');
          });

          // Remove any existing swapped title
          const existingTitle = svgStation.querySelector('.swapped-title');
          if (existingTitle) existingTitle.remove();

          // Create new title text element
          const rect = svgStation.querySelector('rect');
          if (rect) {
            const titleEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            titleEl.classList.add('swapped-title');
            const x = parseFloat(rect.getAttribute('x')) + parseFloat(rect.getAttribute('width')) / 2;
            const y = parseFloat(rect.getAttribute('y')) + parseFloat(rect.getAttribute('height')) - 8;
            titleEl.setAttribute('x', x);
            titleEl.setAttribute('y', y);
            titleEl.setAttribute('fill', '#000');
            titleEl.setAttribute('font-size', '7');
            titleEl.setAttribute('text-anchor', 'middle');
            titleEl.setAttribute('font-family', 'Space Grotesk, sans-serif');
            titleEl.setAttribute('font-weight', '700');
            titleEl.textContent = action.data.redoTitle.toUpperCase().substring(0, 18);
            svgStation.appendChild(titleEl);
          }

          // Add emoji
          const ideaEmoji = action.data.idea?.emoji || getIdeaEmoji(action.data.redoTitle);
          if (ideaEmoji) {
            let emojiEl = svgStation.querySelector('.idea-emoji');
            if (!emojiEl) {
              emojiEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
              emojiEl.classList.add('idea-emoji');
              emojiEl.setAttribute('font-size', '20');
              emojiEl.setAttribute('text-anchor', 'middle');
              if (rect) {
                const x = parseFloat(rect.getAttribute('x')) + parseFloat(rect.getAttribute('width')) / 2;
                const y = parseFloat(rect.getAttribute('y')) + parseFloat(rect.getAttribute('height')) / 2 + 6;
                emojiEl.setAttribute('x', x);
                emojiEl.setAttribute('y', y);
              }
              svgStation.appendChild(emojiEl);
            }
            emojiEl.textContent = ideaEmoji;
          }
        }
      }
    }

    undoStack.push(action);
    updateUndoRedoButtons();
  }

  function updateUndoRedoButtons() {
    const undoBtn = document.getElementById('undoBtn');
    const redoBtn = document.getElementById('redoBtn');
    if (undoBtn) undoBtn.disabled = undoStack.length === 0;
    if (redoBtn) redoBtn.disabled = redoStack.length === 0;
  }

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'z') {
      if (e.shiftKey) {
        redo();
      } else {
        undo();
      }
      e.preventDefault();
    }
    // Escape closes panels
    if (e.key === 'Escape') {
      closeIdeasPanel();
      cancelStationSelection();
    }
  });

  // Undo/Redo button clicks
  document.getElementById('undoBtn')?.addEventListener('click', undo);
  document.getElementById('redoBtn')?.addEventListener('click', redo);

  // === IDEAS PANEL ===
  function openIdeasPanel(forSwap = false) {
    swapMode = forSwap;
    ideasPanel.classList.add('open');
    ideasOverlay.classList.add('visible');
    renderIdeasPanel();
  }

  function closeIdeasPanel() {
    ideasPanel.classList.remove('open');
    ideasOverlay.classList.remove('visible');
    swapMode = false;
  }

  openIdeasBtn.addEventListener('click', () => openIdeasPanel(false));
  closeIdeasBtn.addEventListener('click', closeIdeasPanel);
  ideasOverlay.addEventListener('click', closeIdeasPanel);
  addIdeaBtnPanel.addEventListener('click', () => {
    closeIdeasPanel();
    openIdeaModal();
  });

  // === STATION POPUP ===
  function showStationPopup(stationNum, x, y) {
    const stationData = stationDataContainer.querySelector(`[data-sid="${stationNum}"]`);
    if (!stationData) return;

    currentStation = stationNum;
    popupStationNum.textContent = 'Station ' + stationNum;
    popupTitle.textContent = stationData.querySelector('h3').textContent;
    popupDesc.textContent = stationData.querySelector('p').textContent;
    const popupCat = document.getElementById('popupCategory');
    popupCat.textContent = stationData.dataset.cat || '';

    // Position popup near click - ensure it stays in viewport
    stationPopup.classList.add('visible');
    const popupRect = stationPopup.getBoundingClientRect();
    const popupHeight = popupRect.height || 220;
    const popupWidth = popupRect.width || 320;

    let left = x + 20;
    let top = y - 50;

    // Keep within horizontal bounds
    if (left + popupWidth > window.innerWidth - 10) {
      left = window.innerWidth - popupWidth - 10;
    }
    if (left < 10) left = 10;

    // Keep within vertical bounds
    if (top + popupHeight > window.innerHeight - 10) {
      top = window.innerHeight - popupHeight - 10;
    }
    if (top < 10) top = 10;

    stationPopup.style.left = left + 'px';
    stationPopup.style.top = top + 'px';
  }

  function hideStationPopup() {
    stationPopup.classList.remove('visible');
    currentStation = null;
  }

  popupClose.addEventListener('click', hideStationPopup);
  popupSwapBtn.addEventListener('click', () => {
    hideStationPopup();
    openIdeasPanel(true);
  });

  // === SVG STATION CLICKS ===
  const svgStations = document.querySelectorAll('.station[data-station]');

  // Add mobile info icons to stations
  svgStations.forEach(station => {
    const rect = station.querySelector('rect');
    if (rect) {
      const x = parseFloat(rect.getAttribute('x')) + parseFloat(rect.getAttribute('width')) - 12;
      const y = parseFloat(rect.getAttribute('y')) + 12;
      const infoIcon = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      infoIcon.classList.add('mobile-info-icon');
      infoIcon.innerHTML = `<circle cx="${x}" cy="${y}" r="7" fill="#007AFF" opacity="0.9"/><text x="${x}" y="${y + 3.5}" text-anchor="middle" font-size="10" font-weight="600" fill="#fff">i</text>`;
      station.appendChild(infoIcon);
    }
  });

  // Station clicks are handled after renderIdeasPanel with pendingIdea check

  // Close popup on outside click
  document.addEventListener('click', (e) => {
    if (!stationPopup.contains(e.target) && !e.target.closest('.station')) {
      hideStationPopup();
    }
  });

  // === RENDER IDEAS PANEL ===
  async function renderIdeasPanel() {
    ideasPanelBody.innerHTML = '';

    // Get all ideas from the hidden containers
    const allIdeas = [];

    // Core ideas from HTML (all by Christopher)
    ideaDataContainer.querySelectorAll('.feature-card').forEach(card => {
      if (card.classList.contains('add-idea-card')) return;
      const isCore = card.dataset.core === 'true';
      allIdeas.push({
        title: card.querySelector('h3')?.textContent || '',
        category: card.querySelector('.station-num')?.textContent || 'Idea',
        desc: card.querySelector('p')?.textContent || '',
        author: 'Christopher',
        isCore: isCore,
        element: card
      });
    });

    // Load user-submitted ideas from database
    try {
      const userIdeas = await loadIdeasForPanel();
      userIdeas.forEach(idea => {
        allIdeas.push({
          title: idea.title,
          category: idea.category || 'Concept',
          desc: idea.description || '',
          author: idea.author || 'Anonymous',
          isCore: idea.is_core || false,
          isUserIdea: true,
          id: idea.id
        });
      });
    } catch (e) {
      console.error('Failed to load user ideas for panel:', e);
    }

    // Render each idea
    allIdeas.forEach((idea, idx) => {
      const item = document.createElement('div');
      item.className = 'idea-item';
      const authorHtml = idea.author ? `<div class="idea-item-author">by ${idea.author}</div>` : '';
      item.innerHTML = `
        <div>
          <div class="idea-item-category">${idea.category}</div>
          <h4>${idea.title}</h4>
          <p>${idea.desc}</p>
          ${authorHtml}
        </div>
        <div class="idea-item-actions" style="margin-top:10px;padding-top:10px;border-top:1px solid #eee;display:flex;gap:8px;">
          <button class="use-idea-btn" style="flex:1;padding:8px 12px;background:#111;color:#fff;border:none;border-radius:6px;font-family:'Space Grotesk',sans-serif;font-size:0.8rem;font-weight:600;cursor:pointer;">${swapMode && currentStation ? `Use on Station ${currentStation}` : 'Use on Station'}</button>
          ${!idea.isCore && idea.isUserIdea ? '<button class="delete-idea-btn" style="padding:8px 12px;background:#fff;color:#e53935;border:1px solid #e53935;border-radius:6px;font-size:0.8rem;cursor:pointer;">Delete</button>' : ''}
        </div>
      `;

      // Click to expand/collapse
      item.addEventListener('click', (e) => {
        // Don't toggle if clicking on a button
        if (e.target.closest('button')) return;
        // Collapse all other items
        ideasPanelBody.querySelectorAll('.idea-item.expanded').forEach(other => {
          if (other !== item) other.classList.remove('expanded');
        });
        item.classList.toggle('expanded');
      });

      // Use button - swap to station directly if in swap mode, otherwise start selection
      const useBtn = item.querySelector('.use-idea-btn');
      useBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (swapMode && currentStation) {
          // Direct swap to the pre-selected station
          swapIdeaToStation(idea, currentStation);
          closeIdeasPanel();
          unhighlightStation();
        } else {
          // Start station selection mode
          startStationSelection(idea);
        }
      });

      // Delete button for user ideas
      const delBtn = item.querySelector('.delete-idea-btn');
      if (delBtn) {
        delBtn.addEventListener('click', async (e) => {
          e.stopPropagation();
          if (confirm('Delete this idea?')) {
            await modifyIdeas(ideas => ideas.filter(i => i.id !== idea.id));
            item.remove();
            // Also remove from walkthrough content if exists
            const walkthroughCard = userIdeasContainer.querySelector(`[data-idea-id="${idea.id}"]`);
            if (walkthroughCard) walkthroughCard.remove();
          }
        });
      }

      ideasPanelBody.appendChild(item);
    });
  }

  // Station selection mode
  let pendingIdea = null;

  function startStationSelection(idea) {
    pendingIdea = idea;
    closeIdeasPanel();
    // Scroll map into view
    const mapViewport = document.querySelector('.map-viewport');
    if (mapViewport) {
      mapViewport.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    showStationSelectionOverlay();
  }

  function showStationSelectionOverlay() {
    // Add editing state to body (hides sidebar on mobile)
    document.body.classList.add('selecting-station');
    // Add editing state to map
    const mapViewport = document.querySelector('.map-viewport');
    if (mapViewport) {
      mapViewport.classList.add('selecting-mode');
    }

    // Create prompt centered over the map
    let overlay = document.getElementById('stationSelectOverlay');
    if (!overlay) {
      overlay = document.createElement('div');
      overlay.id = 'stationSelectOverlay';
      overlay.innerHTML = `
        <div style="background:#22c55e;color:#fff;padding:14px 24px;border-radius:10px;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.3);display:flex;align-items:center;gap:16px;">
          <span style="font-family:'Space Grotesk',sans-serif;font-weight:600;">üëÜ Click a station to place your idea</span>
          <button id="cancelStationSelect" style="padding:6px 14px;background:rgba(0,0,0,0.2);border:none;border-radius:4px;cursor:pointer;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:0.85rem;font-weight:500;">Cancel</button>
        </div>
      `;
      document.body.appendChild(overlay);
      document.getElementById('cancelStationSelect').addEventListener('click', cancelStationSelection);
    }

    // Position centered over the map viewport (or center of screen on mobile)
    const isMobile = window.innerWidth <= 768;
    if (isMobile) {
      overlay.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:150;pointer-events:auto;max-width:calc(100vw - 32px);';
    } else if (mapViewport) {
      const rect = mapViewport.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      overlay.style.cssText = `position:fixed;top:${centerY}px;left:${centerX}px;transform:translate(-50%,-50%);z-index:150;pointer-events:auto;`;
    } else {
      overlay.style.cssText = 'position:fixed;top:50vh;left:50vw;transform:translate(-50%,-50%);z-index:150;pointer-events:auto;';
    }
    overlay.style.display = 'block';

    // Highlight stations for selection
    svgStations.forEach(station => {
      station.classList.add('selecting');
    });
  }

  function hideStationSelectionOverlay() {
    const overlay = document.getElementById('stationSelectOverlay');
    if (overlay) overlay.style.display = 'none';
    // Remove editing state from body and map
    document.body.classList.remove('selecting-station');
    const mapViewport = document.querySelector('.map-viewport');
    if (mapViewport) mapViewport.classList.remove('selecting-mode');
    svgStations.forEach(station => {
      station.classList.remove('selecting');
    });
  }

  function cancelStationSelection() {
    pendingIdea = null;
    hideStationSelectionOverlay();
  }

  // Handle station click during selection mode
  svgStations.forEach(station => {
    station.addEventListener('click', (e) => {
      if (pendingIdea) {
        const stationNum = station.dataset.station;
        if (stationNum && !isNaN(stationNum)) {
          // Record for undo
          recordAction('assign', { stationNum, idea: pendingIdea });
          swapIdeaToStation(pendingIdea, stationNum);
          pendingIdea = null;
          hideStationSelectionOverlay();
        }
        e.stopPropagation();
        return;
      }
      // Normal station popup
      const stationNum = station.dataset.station;
      if (!stationNum || isNaN(stationNum)) return;
      showStationPopup(stationNum, e.clientX, e.clientY);
    });
  });

  // Load ideas for panel (used by renderIdeasPanel)
  async function loadIdeasForPanel() {
    const blobId = localStorage.getItem('tushy_rube_blob_id');
    if (blobId) {
      try {
        const res = await fetch(`https://jsonblob.com/api/jsonBlob/${blobId}`);
        const data = await res.json();
        return data.ideas || [];
      } catch (e) { console.error('JSONBlob load failed:', e); }
    }
    try {
      return JSON.parse(localStorage.getItem('tushy_rube_ideas')) || [];
    } catch { return []; }
  }

  // === SWAP IDEA TO STATION ===
  // Circled numbers for stations 1-10
  const stationIcons = { '1': '‚ë†', '2': '‚ë°', '3': '‚ë¢', '4': '‚ë£', '5': '‚ë§', '6': '‚ë•', '7': '‚ë¶', '8': '‚ëß', '9': '‚ë®', '10': '‚ë©' };

  function swapIdeaToStation(idea, stationNum) {
    const stationCard = stationDataContainer.querySelector(`[data-sid="${stationNum}"]`);
    if (!stationCard) {
      console.warn('Station card not found for station:', stationNum);
      return;
    }

    // Update the station card in the walkthrough section
    stationCard.querySelector('h3').textContent = idea.title;
    stationCard.querySelector('p').textContent = idea.desc;
    stationCard.dataset.cat = idea.category || '';

    // Update SVG station data attributes for tooltip
    const svgStation = document.querySelector(`.station[data-station="${stationNum}"]`);
    if (svgStation) {
      const icon = stationIcons[stationNum] || '‚ë©';
      svgStation.dataset.name = icon + ' ' + idea.title;
      svgStation.dataset.desc = idea.desc;
      svgStation.dataset.cat = idea.category || '';
      svgStation.classList.add('has-idea');

      // Hide ALL children except main background rect
      const mainRect = svgStation.querySelector('rect');
      Array.from(svgStation.children).forEach(child => {
        if (child === mainRect || child.classList.contains('mobile-info-icon') || child.classList.contains('idea-emoji') || child.classList.contains('swapped-title')) {
          return; // Keep these visible
        }
        child.classList.add('hidden-illustration');
        child.setAttribute('opacity', '0');
      });

      // Remove any existing swapped title
      const existingTitle = svgStation.querySelector('.swapped-title');
      if (existingTitle) existingTitle.remove();

      // Create new title text element
      const rect = svgStation.querySelector('rect');
      if (rect) {
        const titleEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        titleEl.classList.add('swapped-title');
        const x = parseFloat(rect.getAttribute('x')) + parseFloat(rect.getAttribute('width')) / 2;
        const y = parseFloat(rect.getAttribute('y')) + parseFloat(rect.getAttribute('height')) - 8;
        titleEl.setAttribute('x', x);
        titleEl.setAttribute('y', y);
        titleEl.setAttribute('fill', '#000');
        titleEl.setAttribute('font-size', '7');
        titleEl.setAttribute('text-anchor', 'middle');
        titleEl.setAttribute('font-family', 'Space Grotesk, sans-serif');
        titleEl.setAttribute('font-weight', '700');
        titleEl.textContent = idea.title.toUpperCase().substring(0, 18);
        svgStation.appendChild(titleEl);
      }

      // Add/update emoji icon on the station (for ideas from Ideas panel)
      const ideaEmoji = idea.emoji || getIdeaEmoji(idea.title);
      if (ideaEmoji) {
        let emojiEl = svgStation.querySelector('.idea-emoji');
        if (!emojiEl) {
          emojiEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          emojiEl.classList.add('idea-emoji');
          emojiEl.setAttribute('font-size', '20');
          emojiEl.setAttribute('text-anchor', 'middle');
          // Position based on station's bounding box
          const rect = svgStation.querySelector('rect');
          if (rect) {
            const x = parseFloat(rect.getAttribute('x')) + parseFloat(rect.getAttribute('width')) / 2;
            const y = parseFloat(rect.getAttribute('y')) + parseFloat(rect.getAttribute('height')) / 2 + 6;
            emojiEl.setAttribute('x', x);
            emojiEl.setAttribute('y', y);
          }
          svgStation.appendChild(emojiEl);
        }
        emojiEl.textContent = ideaEmoji;
      }

      // Visual feedback - briefly flash the station green
      svgStation.querySelectorAll('rect').forEach(el => {
        const orig = el.getAttribute('fill');
        el.setAttribute('fill', '#dcfce7');
        setTimeout(() => el.setAttribute('fill', orig || '#fff'), 600);
      });
    }

    console.log('Swapped idea to station', stationNum, ':', idea.title);
  }

  // Tooltip for SVG stations (hover) - desktop only
  const t=document.getElementById('tooltip');
  const isTouchDevice = () => window.matchMedia('(hover: none)').matches || 'ontouchstart' in window;
  svgStations.forEach(el=>{
    el.addEventListener('mouseenter',e=>{
      if (isTouchDevice()) return; // No hover tooltip on mobile
      const n=el.dataset.name,d=el.dataset.desc,c=el.dataset.cat||'';if(!n)return;t.querySelector('.tt-title').textContent=n;t.querySelector('.tt-cat').textContent=c;t.querySelector('.tt-desc').textContent=d;t.classList.add('visible');
    });
    el.addEventListener('mousemove',e=>{
      if (isTouchDevice()) return;
      t.style.left=(e.clientX+16)+'px';t.style.top=(e.clientY-10)+'px';
    });
    el.addEventListener('mouseleave',()=>t.classList.remove('visible'))
  });


  // === IDEA MANAGEMENT SYSTEM ===
  // JSONBlob - free cloud storage, no account needed
  const BLOB_ID_KEY = 'tushy_rube_blob_id';
  const STORAGE_KEY = 'tushy_rube_ideas';

  const userIdeasContainer = document.getElementById('user-ideas-container');
  const addIdeaBtn = document.getElementById('add-idea-btn');
  const ideaModal = document.getElementById('idea-modal');
  const ideaModalClose = document.getElementById('idea-modal-close');
  const ideaCancelBtn = document.getElementById('idea-cancel');
  const ideaSaveBtn = document.getElementById('idea-save');

  // Mark all existing HTML idea cards as core (non-deletable)
  ideaDataContainer.querySelectorAll('.feature-card').forEach(card => {
    if (!card.classList.contains('add-idea-card')) {
      card.dataset.core = 'true';
    }
  });

  // Auto-categorize based on keywords
  function categorizeIdea(title, desc) {
    const text = (title + ' ' + desc).toLowerCase();
    if (/finale|final|end|climax|last/.test(text)) return 'Finale Option';
    if (/interact|button|press|pull|push|visitor|guest|play/.test(text)) return 'Interactive Option';
    if (/scent|smell|aroma|fragrance|candle|mist/.test(text)) return 'Sensory';
    if (/sound|music|audio|tone|bell|chime/.test(text)) return 'Sensory';
    if (/light|glow|led|illuminate|visual/.test(text)) return 'Sensory';
    if (/water|splash|spray|flow|fountain/.test(text)) return 'Water Feature';
    if (/always|continuous|perpetual|loop|kinetic/.test(text)) return 'Kinetic / Always-On';
    return 'Feature';
  }

  // Get or create blob ID
  async function getBlobId() {
    let blobId = localStorage.getItem(BLOB_ID_KEY);
    if (!blobId) {
      // Create new blob
      try {
        const res = await fetch('https://jsonblob.com/api/jsonBlob', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ideas: [] })
        });
        const location = res.headers.get('Location');
        blobId = location.split('/').pop();
        localStorage.setItem(BLOB_ID_KEY, blobId);
      } catch (e) {
        console.error('Failed to create blob:', e);
        return null;
      }
    }
    return blobId;
  }

  // Load ideas from JSONBlob
  async function loadIdeas() {
    const blobId = await getBlobId();
    if (blobId) {
      try {
        const res = await fetch(`https://jsonblob.com/api/jsonBlob/${blobId}`);
        const data = await res.json();
        return data.ideas || [];
      } catch (e) { console.error('JSONBlob load failed:', e); }
    }
    // Fallback to localStorage
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    } catch { return []; }
  }

  // Save all ideas to JSONBlob
  async function saveAllIdeas(ideas) {
    // Always save to localStorage as backup
    localStorage.setItem(STORAGE_KEY, JSON.stringify(ideas));

    const blobId = await getBlobId();
    if (blobId) {
      try {
        await fetch(`https://jsonblob.com/api/jsonBlob/${blobId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ideas })
        });
      } catch (e) { console.error('JSONBlob save failed:', e); }
    }
  }

  // Helper to get current ideas, modify, and save
  async function modifyIdeas(fn) {
    const ideas = await loadIdeas();
    const result = fn(ideas);
    await saveAllIdeas(result !== undefined ? result : ideas);
    return ideas;
  }

  // Generate unique ID
  function genId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
  }

  // Add station picker to idea card (for assigning idea to station)
  function addStationPicker(card) {
    // Station picker is now replaced by "Use" button approach
    // This function is kept for compatibility but does nothing
  }

  // Render a single idea card
  function renderIdeaCard(idea) {
    const card = document.createElement('div');
    card.className = 'feature-card idea-card user-idea';
    card.dataset.ideaId = idea.id;
    if (idea.is_core) card.dataset.core = 'true';

    const tags = (idea.tags || []).map(t =>
      `<span class="product-tag">${t}</span>`
    ).join('');

    const authorHtml = idea.author ? `<span class="idea-author">by ${idea.author}</span>` : '';

    card.innerHTML = `
      <div class="idea-actions">
        <button class="idea-action-btn core ${idea.is_core ? 'is-core' : ''}" title="${idea.is_core ? 'Core idea' : 'Make core (non-deletable)'}">‚òÖ</button>
        ${!idea.is_core ? '<button class="idea-action-btn delete" title="Delete idea">‚úï</button>' : ''}
      </div>
      <div class="station-num">${idea.category || 'Custom Idea'} ${authorHtml}</div>
      <h3>${idea.title}</h3>
      <p>${idea.description}</p>
      <div class="products-used">${tags}</div>
    `;

    // Add station picker
    addStationPicker(card);

    // Core button click - promote to core
    const coreBtn = card.querySelector('.idea-action-btn.core');
    coreBtn.addEventListener('click', async (e) => {
      e.stopPropagation();
      if (idea.is_core) return;
      idea.is_core = true;
      await modifyIdeas(ideas => {
        const idx = ideas.findIndex(i => i.id === idea.id);
        if (idx !== -1) ideas[idx].is_core = true;
        return ideas;
      });
      card.dataset.core = 'true';
      coreBtn.classList.add('is-core');
      coreBtn.title = 'Core idea';
      const delBtn = card.querySelector('.idea-action-btn.delete');
      if (delBtn) delBtn.remove();
    });

    // Delete button click
    const delBtn = card.querySelector('.idea-action-btn.delete');
    if (delBtn) {
      delBtn.addEventListener('click', async (e) => {
        e.stopPropagation();
        if (confirm('Delete this idea?')) {
          await modifyIdeas(ideas => ideas.filter(i => i.id !== idea.id));
          card.remove();
          // Refresh ideas panel if open
          if (ideasPanel.classList.contains('open')) {
            renderIdeasPanel();
          }
        }
      });
    }

    return card;
  }

  // Render all user ideas
  async function renderAllUserIdeas() {
    userIdeasContainer.innerHTML = '';
    const ideas = await loadIdeas();
    ideas.forEach(idea => {
      userIdeasContainer.appendChild(renderIdeaCard(idea));
    });
  }

  // Open modal
  function openIdeaModal() {
    document.getElementById('idea-author').value = '';
    document.getElementById('idea-title').value = '';
    document.getElementById('idea-desc').value = '';
    document.getElementById('idea-emoji').value = '';
    document.getElementById('idea-tags').value = '';
    ideaModal.classList.add('visible');
  }

  // Close modal
  function closeIdeaModal() {
    ideaModal.classList.remove('visible');
  }

  // Save new idea
  async function saveNewIdea() {
    const author = document.getElementById('idea-author').value.trim();
    const title = document.getElementById('idea-title').value.trim();
    const desc = document.getElementById('idea-desc').value.trim();
    const tagsStr = document.getElementById('idea-tags').value.trim();
    const category = document.getElementById('idea-category').value;
    const emoji = document.getElementById('idea-emoji').value.trim();

    if (!title) {
      alert('Please enter a title');
      return;
    }

    // Show saving state
    const saveBtn = document.getElementById('idea-save');
    const originalText = saveBtn.textContent;
    saveBtn.textContent = 'Saving...';
    saveBtn.disabled = true;

    const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(Boolean) : [];

    const idea = {
      id: genId(),
      author: author || null,
      category,
      title,
      description: desc,
      emoji: emoji || null,
      tags,
      is_core: false,
      created_at: new Date().toISOString()
    };

    try {
      await modifyIdeas(ideas => { ideas.push(idea); return ideas; });
      const card = renderIdeaCard(idea);
      userIdeasContainer.appendChild(card);

      // Close modal but keep ideas panel open
      closeIdeaModal();

      // Clear form
      document.getElementById('idea-author').value = '';
      document.getElementById('idea-title').value = '';
      document.getElementById('idea-desc').value = '';
      document.getElementById('idea-emoji').value = '';
      document.getElementById('idea-tags').value = '';

      // Re-render ideas panel with new idea
      await renderIdeasPanel();

      // Scroll to bottom and flash the new idea
      setTimeout(() => {
        const items = ideasPanelBody.querySelectorAll('.idea-item');
        const lastItem = items[items.length - 1];
        if (lastItem) {
          lastItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
          lastItem.style.transition = 'background 0.3s';
          lastItem.style.background = '#dcfce7';
          setTimeout(() => {
            lastItem.style.background = '';
          }, 1500);
        }
      }, 100);
    } finally {
      saveBtn.textContent = originalText;
      saveBtn.disabled = false;
    }
  }

  // Event listeners
  addIdeaBtn.addEventListener('click', openIdeaModal);
  ideaModalClose.addEventListener('click', closeIdeaModal);
  ideaCancelBtn.addEventListener('click', closeIdeaModal);
  ideaSaveBtn.addEventListener('click', saveNewIdea);
  ideaModal.addEventListener('click', (e) => {
    if (e.target === ideaModal) closeIdeaModal();
  });

  // Category select
  const categorySelect = document.getElementById('category-select');
  const categorySelected = document.getElementById('category-selected');
  const categoryOptions = document.getElementById('category-options');
  const categoryInput = document.getElementById('idea-category');
  const categoryIcons = {'Finale Option':'üèÅ','Interactive Option':'üïπÔ∏è','Sensory':'‚ú®','Water Feature':'üí¶','Kinetic / Always-On':'‚öôÔ∏è','Feature':'‚≠ê'};

  categorySelected.addEventListener('click', () => {
    categoryOptions.classList.toggle('open');
  });
  categoryOptions.querySelectorAll('.category-option').forEach(opt => {
    opt.addEventListener('click', () => {
      const val = opt.dataset.value;
      categoryInput.value = val;
      categorySelected.querySelector('.cat-icon').textContent = categoryIcons[val] || '‚≠ê';
      categorySelected.querySelector('.cat-label').textContent = val;
      categoryOptions.classList.remove('open');
    });
  });

  // Emoji picker
  const emojiPicker = document.getElementById('emoji-picker');
  const emojiSelected = document.getElementById('emoji-selected');
  const emojiGrid = document.getElementById('emoji-grid');
  const emojiInput = document.getElementById('idea-emoji');

  emojiSelected.addEventListener('click', () => {
    emojiGrid.classList.toggle('open');
  });
  emojiGrid.querySelectorAll('span').forEach(span => {
    span.addEventListener('click', () => {
      const emoji = span.dataset.emoji;
      emojiInput.value = emoji;
      emojiSelected.textContent = emoji;
      emojiGrid.classList.remove('open');
    });
  });

  // Close dropdowns on outside click
  document.addEventListener('click', (e) => {
    if (!categorySelect.contains(e.target)) categoryOptions.classList.remove('open');
    if (!emojiPicker.contains(e.target)) emojiGrid.classList.remove('open');
  });

  // Initialize
  renderAllUserIdeas();
</script>

<script>
  // Adjust for embed mode
  if (new URLSearchParams(window.location.search).get('embed') === '1') {
    document.body.classList.add('embed-mode');
  }
  // Ensure all details elements start closed (prevent browser caching open state)
  document.querySelectorAll('details.cost-category').forEach(d => d.removeAttribute('open'));
</script>
</body>
</html>
